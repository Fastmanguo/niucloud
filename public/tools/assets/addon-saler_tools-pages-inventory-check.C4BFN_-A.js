import{d as e,W as t,r as a,cq as s,E as l,s as o,H as n,a5 as r,f as i,w as c,n as u,a6 as d,i as m,b as f,aZ as x,e as _,ar as p,as as h,l as y,D as b,aJ as v,aI as g,cM as k,aM as C,cs as w,m as j,aL as I,a4 as T,cg as P,cE as z,ch as U,o as S,c as V,h as H,u as L,p as M,t as A,g as E,v as R,a7 as q,at as D,M as K,R as W,a as $,K as B,_ as F}from"./index-DlbBJ3bC.js";import{_ as J}from"./mescroll-body.CzShuCTj.js";import{u as N}from"./useMescroll.lU6SPXzn.js";import{a as O,i as Z,b as G}from"./Inventory.DjfzdujZ.js";import{s as Q}from"./index.Bh4RlGGN.js";import{b as X}from"./browser.BTH0nPVW.js";import"./mescroll-empty.lkR5ZfjC.js";import"./index.DK0m-eAv.js";import"./index.COs-0cDI.js";import"./auth.BQpGjoDu.js";/* empty css                                                              *//* empty css                                                                     */const Y=F(e({__name:"check",setup(e){const F=t({inventory_id:0,inventory:null,status:0,list:[],searchParams:{inventory_id:6,status:0,category_id:0},footerTabIndex:0,headerTabIndex:0,mescrollUp:{page:{size:10}},isH5:!1,mescrollRef:null}),Y=(a(!1),s()),ee=l({get(){if(!F.inventory||"store"!=F.inventory.inventory_type&&"pawned_goods"!=F.inventory.inventory_type)return Y.value,[{category_key:"ALL",category_id:null},...Y.value];{let e=Y.value,t=[{category_key:"ALL",category_id:null}],a=F.inventory.category_ids;return e.forEach((e=>{a.includes(e.category_id)&&t.push(e)})),t}},set(e){}}),te=e=>{F.searchParams.category_id=e.category_id,fe().scrollTo(0,300),fe().resetUpScroll()},ae=a(),se=(e,t)=>{Z({inventory_id:F.searchParams.inventory_id,goods_id:e.goods_id,status:1}).then((()=>{B({title:o("success"),icon:"none"})})),X.nextTick((()=>{le(t)}))},le=e=>{F.list.splice(e,1),0==F.list.length&&(fe().scrollTo(0,300),fe().resetUpScroll())},oe=t({data:{goods_id:0,status:-1,remark:"",lose_num:0},show:!1,index:0,maxCount:0,existCount:0}),ne=l((()=>{let e=0;return e=oe.maxCount-oe.data.lose_num,e})),re=(e,t)=>{let a;a=1==F.headerTabIndex?1:-1,oe.data={goods_id:e.goods_id,status:a,remark:e.remark,lose_num:e.lose_num},oe.index=t,oe.maxCount=e.goods_num,oe.show=!0},ie=t([{name:o("not_counted")},{name:o("counted")}]),ce=e=>{1==e?(F.searchParams.status=1,F.headerTabIndex=0):F.searchParams.status=e,F.footerTabIndex=e,fe().scrollTo(0,300),fe().resetUpScroll()},ue=t([{name:o("existence")},{name:o("absence")}]),de=e=>{F.searchParams.status=0===e?1:-1,F.headerTabIndex=e,fe().scrollTo(0,300),fe().resetUpScroll()},{mescrollInit:me,getMescroll:fe}=N(h,p),xe=a(!0);F.isH5=!0;const _e=()=>{B({title:"H5暂不支持此功能",icon:"none"})},pe=e=>{let t={page:e.num,limit:e.size,...F.searchParams};1==e.num&&(F.list=[]),xe.value=!0,G(t).then((t=>{let a=t.data.data;e.endSuccess(a.length),1==e.num&&(F.list=[]),F.list=F.list.concat(a),e.endSuccess(t.data.data.length),xe.value=!1})).catch((()=>{xe.value=!1,e.endErr()}))};return n((e=>{F.searchParams.inventory_id=e.inventory_id,F.status=e.status,O(F.searchParams.inventory_id).then((({data:e})=>{F.inventory=e})).catch((()=>{}))})),(e,t)=>{const a=f(_("up-icon"),y),s=m,l=f(_("up-navbar"),b),n=f(_("up-search"),v),p=f(_("up-tabs"),g),h=f(_("up-subsection"),k),N=(f(_("up-divider"),C),f(_("up-sticky"),w)),O=f(_("up-image"),j),G=f(_("up-text"),I),X=f(_("up-button"),T),Y=f(_("up-line"),P),fe=f(_("mescroll-body"),J),xe=f(_("up-number-box"),z),he=f(_("up-textarea"),U),ye=f(_("up-popup"),x);return S(),r(d,null,[i(s,{style:u(e.themeColor())},{default:c((()=>[i(N,{bgColor:"#f3f4f6"},{default:c((()=>[i(l,{title:0==F.status?L(o)("inventory_lists_underway"):L(o)("inventory_lists_completed"),autoBack:!0,safeAreaInsetTop:!0,placeholder:!F.isH5},{right:c((()=>[i(s,{class:"u-nav-slot"},{default:c((()=>[i(a,{name:"scan",size:"21",onClick:_e})])),_:1})])),_:1},8,["title","placeholder"]),i(s,{class:"bg-[#fff] p-2"},{default:c((()=>[i(n,{placeholder:L(o)("maintenance_search"),shape:"square",showAction:!1},null,8,["placeholder"])])),_:1}),i(s,{class:"bg-[#fff]"},{default:c((()=>[i(p,{style:{"white-space":"nowrap !important"},list:ee.value,keyName:"category_name",activeStyle:"color:var(--theme-color-primary);font-size:16px",lineWidth:"30",onChange:te,lineColor:"var(--theme-color-primary)",inactiveStyle:"color:var(--theme-color-main);font-size:13px",itemStyle:"padding:5px 10px;z-index:2;display: inline-block"},{content:c((e=>[M(A(L(o)(e.item.category_key)),1)])),_:1},8,["list"])])),_:1}),0!=F.searchParams.status?(S(),V(s,{key:0,class:"bg-[#fff] flex justify-start items-center box-border box-border p-2"},{default:c((()=>[i(h,{list:ue,current:F.headerTabIndex,"onUpdate:current":t[0]||(t[0]=e=>F.headerTabIndex=e),mode:"subsection",onChange:de},null,8,["list","current"])])),_:1})):H("",!0),H("",!0)])),_:1}),i(fe,{ref:"mescrollRef",onInit:L(me),onUp:pe,onDown:pe,up:F.mescrollUp,class:q(F.isH5?"mt-[44px]":""),top:"0"},{default:c((()=>[F.list.length?(S(),V(s,{key:0},{default:c((()=>[(S(!0),r(d,null,D(F.list,((e,t)=>(S(),r(d,null,[i(s,{class:"flex flex-col p-3 bg-[#fff] box-border",onClick:t=>(e=>{$({url:`/addon/saler_tools/pages/product/detail?type=check&goods_id=${e.goods_id}&inventory_id=${e.inventory_id}`})})(e)},{default:c((()=>[i(s,{class:"flex justify-between items-center min-h-[90px]"},{default:c((()=>[e.goods_cover?(S(),V(O,{key:0,"show-loading":!0,src:L(K)(e.goods_cover),mode:"aspectFit",width:"100px",radius:"5",height:"100px",class:"flex items-center"},null,8,["src"])):H("",!0),i(s,{class:"flex justify-between flex-col flex-1 pl-2 min-h-[90px]"},{default:c((()=>[i(s,{class:"flex items-baseline leading-5 text-[14px] flex-1 text-[var(--theme-color-main)]"},{default:c((()=>[i(G,{lines:2,text:e.goods_name},null,8,["text"])])),_:2},1024),i(s,{class:"text-[var(--theme-text-blue)] mt-1 text-xs flex justify-start items-center"}),i(s,{class:"flex items-center my-1 text-[12px] my-2 text-[var(--theme-text-blue)]"},{default:c((()=>[i(s,null,{default:c((()=>[M(A(L(o)("form.count"))+" ："+A(e.goods_num),1)])),_:2},1024),E(i(s,{class:"mx-2 text-[var(--theme-border)] leading-4"},{default:c((()=>[M("|")])),_:2},1536),[[R,0!=e.status]]),E(i(s,null,{default:c((()=>[M(A(L(o)("absence"))+" ："+A(e.lose_num),1)])),_:2},1536),[[R,0!=e.status]]),E(i(s,{class:"mx-2 text-[var(--theme-border)] leading-4"},{default:c((()=>[M("|")])),_:2},1536),[[R,0!=e.status]]),E(i(s,null,{default:c((()=>[M(A(L(o)("existence"))+" ："+A(e.exist_num),1)])),_:2},1536),[[R,0!=e.status]])])),_:2},1024),E(i(s,{class:"flex justify-end items-center"},{default:c((()=>[F.isH5?(S(),V(s,{key:1,class:"flex justify-end items-center"},{default:c((()=>[i(s,{class:"mx-2"},{default:c((()=>[i(X,{text:L(o)("absence"),plain:!0,color:"var(--theme-color-primary)",hairline:!0,onClick:a=>re(e,t),size:"small"},null,8,["text","onClick"])])),_:2},1024),i(s,null,{default:c((()=>[i(X,{text:L(o)("existence"),color:"var(--theme-color-primary)",size:"small",onClick:a=>se(e,t)},null,8,["text","onClick"])])),_:2},1024)])),_:2},1024)):(S(),V(s,{key:0,class:"flex justify-end items-center"},{default:c((()=>[i(s,{onClick:W((a=>re(e,t)),["stop"]),class:"mx-2"},{default:c((()=>[i(X,{text:L(o)("absence"),plain:!0,color:"var(--theme-color-primary)",hairline:!0,size:"small"},null,8,["text"])])),_:2},1032,["onClick"]),i(s,{onClick:W((a=>se(e,t)),["stop"])},{default:c((()=>[i(X,{text:L(o)("existence"),color:"var(--theme-color-primary)",size:"small"},null,8,["text"])])),_:2},1032,["onClick"])])),_:2},1024))])),_:2},1536),[[R,0==e.status]]),E(i(s,{class:"flex justify-end items-center"},{default:c((()=>[F.isH5?(S(),V(s,{key:1},{default:c((()=>[i(X,{text:L(o)("modify_inventory_status"),color:"var(--theme-color-primary)",onClick:a=>re(e,t),size:"mini"},null,8,["text","onClick"])])),_:2},1024)):(S(),V(s,{key:0,onClick:W((a=>re(e,t)),["stop"])},{default:c((()=>[i(X,{text:L(o)("modify_inventory_status"),color:"var(--theme-color-primary)",size:"mini"},null,8,["text"])])),_:2},1032,["onClick"]))])),_:2},1536),[[R,0!=e.status]])])),_:2},1024)])),_:2},1024),i(s,{class:"flex items-center text-[12px] mt-2 text-[var(--theme-text-red)]"},{default:c((()=>[M(A(L(o)("form.location"))+" ："+A(e.watch_location||"-"),1)])),_:2},1024)])),_:2},1032,["onClick"]),i(Y)],64)))),256))])),_:1})):H("",!0)])),_:1},8,["onInit","up","class"]),i(s,{style:{"padding-bottom":"calc(env(safe-area-inset-bottom) + 60px)"}}),i(s,{class:"custom-subsection main-fix-footer flex justify-between items-center",style:{"box-shadow":"var(--theme-box-shadow)"}},{default:c((()=>[i(h,{list:ie,current:F.footerTabIndex,"onUpdate:current":t[2]||(t[2]=e=>F.footerTabIndex=e),mode:"subsection",activeColor:"var(--theme-text-blue)",class:"!h-[38px]",onChange:ce},null,8,["list","current"])])),_:1})])),_:1},8,["style"]),i(ye,{show:oe.show,mode:"bottom"},{default:c((()=>[i(s,{class:"p-4 flex justify-between items-center"},{default:c((()=>[i(s),i(s,{class:"flex !text-center font-bold text-[30rpx]"},{default:c((()=>[M(A(L(o)("inventory")),1)])),_:1}),i(a,{name:"close",size:"15",onClick:t[3]||(t[3]=e=>oe.show=!1)})])),_:1}),i(Y),i(s,{class:"flex justify-between items-center p-4 w-full box-border"},{default:c((()=>[i(s,{class:"flex"},{default:c((()=>[M(A(L(o)("absence_count")),1)])),_:1}),i(s,null,{default:c((()=>[i(xe,{modelValue:oe.data.lose_num,"onUpdate:modelValue":t[4]||(t[4]=e=>oe.data.lose_num=e),max:oe.maxCount,min:0},null,8,["modelValue","max"])])),_:1})])),_:1}),i(s,{class:"flex justify-between items-center p-4 pt-0 w-full box-border"},{default:c((()=>[i(s,{class:"flex"},{default:c((()=>[M(A(L(o)("absence_count")),1)])),_:1}),i(s,null,{default:c((()=>[M(A(ne.value),1)])),_:1})])),_:1}),i(s,{class:"px-4 flex flex-col !box-border"},{default:c((()=>[i(s,{class:"flex justify-start items-center mb-2"},{default:c((()=>[i(s,{class:"text-sm text-[var(--theme-color-main)]"},{default:c((()=>[M(A(L(o)("take_stock_remark")),1)])),_:1}),i(s,{class:"text-xs text-[var(--theme-color-tips)]"},{default:c((()=>[M(A(L(o)("optional")),1)])),_:1})])),_:1}),i(he,{placeholder:L(o)("input.take_stock_remark"),border:"none",height:"50px",maxlength:"50",modelValue:oe.data.remark,"onUpdate:modelValue":t[5]||(t[5]=e=>oe.data.remark=e),class:"!bg-[#f4f5f7]"},null,8,["placeholder","modelValue"])])),_:1}),i(s,{class:"flex gap-3 mb-5 p-4"},{default:c((()=>[i(X,{onClick:t[6]||(t[6]=e=>oe.show=!1),class:"!text-[var(--theme-color-main)]",color:"#f4f5f7",text:L(o)("cancel")},null,8,["text"]),i(X,{text:L(o)("OK"),onClick:t[7]||(t[7]=e=>(0==oe.data.lose_num?oe.data.status=1:oe.data.status=-1,void Z({inventory_id:F.searchParams.inventory_id,...oe.data}).then((()=>{B({title:o("success"),icon:"none"}),oe.show=!1,0==F.footerTabIndex||0==F.headerTabIndex&&-1==oe.data.status||1==F.headerTabIndex&&1==oe.data.status?le(oe.index):F.list[oe.index].lose_num=oe.data.lose_num})))),color:"var(--theme-color-primary)"},null,8,["text"])])),_:1})])),_:1},8,["show"]),i(Q,{ref_key:"screenPopupRef",ref:ae,modelValue:F.searchParams,"onUpdate:modelValue":t[8]||(t[8]=e=>F.searchParams=e)},null,8,["modelValue"])],64)}}}),[["__scopeId","data-v-b09566ed"]]);export{Y as default};
