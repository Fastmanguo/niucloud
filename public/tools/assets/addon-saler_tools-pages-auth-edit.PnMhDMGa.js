import{d as e,r as l,E as a,b as t,l as o,e as s,a5 as n,o as r,a6 as u,f as c,c as d,h as i,i as m,n as f,w as p,g as h,v as _,cU as v,a7 as x,R as b,p as y,t as g,at as w,_ as k,ac as C,K as V,W as j,s as F,H as z,x as A,C as L,ah as U,aZ as E,D as N,Y as O,aM as B,bz as P,aJ as I,a4 as S,cg as K,ci as R,cj as T,bk as $,cN as W,u as q}from"./index-DlbBJ3bC.js";import{_ as D}from"./loading-page.vue_vue_type_script_setup_true_lang.B0pUTkMl.js";import{b as H,c as J,d as M,e as Y,f as Z,h as G,l as Q,u as X,i as ee,j as le}from"./auth.BQpGjoDu.js";const ae=k(e({__name:"tree",props:{node:{type:Object,default:()=>{}},props:{type:Object,default:()=>{}},checkedValue:{type:Array,default:()=>[]},level:{type:Number,default:0},parent:{type:[Object,null],default:()=>null},disabled:{type:Boolean,default:!1}},emits:["changeNode"],setup(e,{emit:k}){const C=e,V=l(!1),j=l([]),F=a((()=>{let e=C.node[C.props.children];return!!(e&&e.length>0)&&(j.value=e,!0)})),z=a((()=>{var e;return null==(e=C.checkedValue)?void 0:e.includes(C.node[C.props.value])})),A=k,L=()=>{let e=[];C.parent&&(e=[C.parent]),A("changeNode",C.node,e)},U=(e,l)=>{let a=l;C.parent&&(a=[C.parent,...l]),A("changeNode",e,a)},E=a((()=>function e(l){let a=1;if(l[C.props.children]&&l[C.props.children].length>0)for(const t of l[C.props.children])a+=e(t);return a}(C.node))),N=a((()=>function e(l,a){let t=0;if(a.includes(l[C.props.value])&&t++,l[C.props.children]&&l[C.props.children].length>0)for(const o of l[C.props.children])t+=e(o,a);return t}(C.node,C.checkedValue)));return(l,a)=>{const k=t(s("up-icon"),o),A=m,O=v;return r(),n(u,null,[c(A,{class:"tree-item",style:f({paddingLeft:20*C.level+(F.value?0:26)+"px"})},{default:p((()=>[c(A,{class:"tree-label"},{default:p((()=>[F.value?(r(),d(A,{key:0},{default:p((()=>[c(A,{class:"option-icon",onClick:a[0]||(a[0]=e=>V.value=!V.value)},{default:p((()=>[h(c(k,{name:"minus",color:"var(--theme-color-main)"},null,512),[[_,V.value]]),h(c(k,{name:"plus",color:"var(--theme-color-main)"},null,512),[[_,!V.value]])])),_:1})])),_:1})):i("",!0),c(O,{onClick:b(L,["stop"]),disabled:C.disabled,checked:z.value,style:{transform:"scale(0.85)"},color:"#fff",class:x(["rounded-[2px] mr-1 w-22px h-22px flex items-center justify-center",C.disabled?"bg-[var(--theme-border)]":z.value?"bg-[var(--theme-color-primary)]":""])},null,8,["disabled","checked","class"]),c(A,{onClick:b(L,["stop"]),class:x(z.value?"text-[var(--theme-color-primary)]":"text-[var(--theme--color-main)]")},{default:p((()=>[y(g(C.node[C.props.label]),1)])),_:1},8,["class"]),F.value?(r(),d(A,{key:1,class:"ml-2 text-[var(--theme-text-red)] text-sm"},{default:p((()=>[y(" ("+g(N.value)+"/"+g(E.value)+") ",1)])),_:1})):i("",!0)])),_:1}),F.value?(r(),d(A,{key:0,class:"tree-expand",onClick:a[1]||(a[1]=b((e=>V.value=!V.value),["stop"]))},{default:p((()=>[y(g(V.value?"收起":"展开"),1)])),_:1})):i("",!0)])),_:1},8,["style"]),F.value&&V.value?(r(),d(A,{key:0},{default:p((()=>[(r(!0),n(u,null,w(j.value,((l,a)=>(r(),d(ae,{key:a,props:C.props,node:l,"checked-value":C.checkedValue,level:C.level+1,parent:e.node,onChangeNode:U},null,8,["props","node","checked-value","level","parent"])))),128))])),_:1})):i("",!0)],64)}}}),[["__scopeId","data-v-7f017c46"]]),te=e({__name:"index",props:{data:{type:Array,default:[]},modelValue:{type:Array,default:[]},props:{type:Object,default:()=>{}},disabled:{type:Boolean,default:!1},checkedValue:{type:Array,default:()=>[]}},emits:["update:modelValue"],setup(e,{emit:t}){const o=e,s=l([]),c=l([]);C((()=>o.modelValue),(()=>{c.value=o.modelValue}),{deep:!0,immediate:!0});const i=e=>{c.value.includes(e)||c.value.push(e)},f=e=>{let l=e[v.value.value],a=e[v.value.children];(e=>{let l;-1!==(l=c.value.indexOf(e))&&c.value.splice(l,1)})(l),a&&a.length>0&&a.forEach((e=>{f(e)}))},h=e=>{let l=e[v.value.value],a=e[v.value.children];i(l),a&&a.length>0&&a.forEach((e=>{h(e)}))},_=(e,l)=>{if(o.disabled)return void V({title:"请开启【设置权限】按钮再进行权限设置",icon:"none"});console.log("handleChangeNode",e,l);let a=e[v.value.value];c.value.includes(a)?f(e):(h(e),l&&l.length>0&&l.forEach((e=>{e&&i(e[v.value.value])})))},v=a((()=>({lebel:"label",value:"value",children:"children",...o.props}))),x=a((()=>{const e=o.data;return s.value=e,!s.value||0===s.value.length}));return(e,l)=>{const a=m;return x.value?(r(),d(a,{key:0})):(r(),d(a,{key:1},{default:p((()=>[(r(!0),n(u,null,w(s.value,((e,l)=>(r(),d(ae,{key:l,props:v.value,node:e,"checked-value":c.value,level:1,onChangeNode:_,disabled:o.disabled},null,8,["props","node","checked-value","disabled"])))),128))])),_:1}))}}}),oe=k(e({__name:"edit",setup(e){const h=j({loading:!0,type:"",uid:0,roleForm:{role_name:"",rules:[]},roleList:[],form:{},isEnablePower:1,showAll:!1,collapseRef:null,sonItemRef:null,menuList:[],munuCount:0}),_=l(`${F("update")}${h.roleForm.real_name?h.roleForm.real_name:F("shop_manager")}${F("auth_and_save")}`),v=async()=>{h.uid?(await H(h.uid).then((e=>{h.form=e.data})).catch((e=>{V({title:e.msg,icon:"none"})})),1==h.form.is_admin&&L({title:F("unable_edit_super_admin"),url:"/addon/saler_tools/pages/auth/list"}),h.form.role_ids.length>0&&await b(),h.loading=!1):h.loading=!1},b=()=>J(h.form.role_ids[0]).then((e=>{h.roleForm=e.data})).catch((e=>{V({title:e.msg,icon:"none"})})),k=a({get:()=>{if(!(h.form.role_ids&&h.form.role_ids.length>0))return!1;{let e=h.form.role_ids[0];for(let l=0;l<h.roleList.length;l++){const a=h.roleList[l];if(a.role_id==e)return a.role_name}}},set:()=>{}});C((()=>h.menuList),(()=>{h.munuCount=0,ae(h.menuList)}),{deep:!0,immediate:!1});const ae=e=>e.forEach((e=>(h.munuCount++,e.children&&ae(e.children)))),oe=()=>{Z(h.roleForm).then((e=>{V({title:F("add_success"),icon:"none"}),h.roleForm.role_name="",se()})).catch((()=>{V({title:F("add_error"),icon:"none"})})).finally((()=>{de.value=!1}))},se=()=>{M().then((e=>{h.roleList=e.data}))},ne=l(!1),re=j([{text:F("delete")}]),ue=e=>{0==e?Q(h.form.uid).then((e=>{V({icon:"none",title:e.msg})})).catch((e=>{V({icon:"none",title:e.msg})})):X(h.form.uid).then((e=>{V({icon:"none",title:e.msg})})).catch((e=>{V({icon:"none",title:e.msg})}))},ce=l(!1),de=l(!1),ie=()=>{Y().then((e=>{h.menuList=e.data}))},me=async()=>{let e;e=await ee(h.roleForm),1==e.code&&(e=await le(h.form),1==e.code?(b(),V({title:F("save_success"),icon:"none"})):V({title:F("save_timeout"),icon:"none"}))},fe=()=>{ee(h.roleForm).then((e=>{V({title:F("save_auth_set_success"),icon:"none"})})).catch((()=>{V({title:F("save_auth_set_error"),icon:"none"})})).finally((()=>{ne.value=!1}))};return z((e=>{h.uid=e.uid,h.type=e.type,se(),v(),ie()})),A((()=>{se(),v(),ie()})),(e,l)=>{const a=t(s("up-navbar"),N),v=m,C=t(s("up-input"),O),j=t(s("up-divider"),B),z=t(s("up-icon"),o),A=t(s("up-switch"),P),L=t(s("up-search"),I),H=t(s("up-button"),S),J=t(s("up-modal"),U),M=t(s("up-line"),K),Y=t(s("up-radio"),R),Z=t(s("up-radio-group"),T),Q=t(s("up-swipe-action-item"),$),X=t(s("up-swipe-action"),W),ee=t(s("up-popup"),E),le=t(s("loading-page"),D);return r(),n(u,null,[c(v,{style:f(e.themeColor()),class:"main-fix-footer-safe"},{default:p((()=>[c(a,{title:"add"==h.type?q(F)("add_employee"):q(F)("edit_employee"),autoBack:!0,safeAreaInsetTop:!0,placeholder:!0},null,8,["title"]),c(v,{class:"flex flex-col text-sm rounded m-2 bg-[#fff]"},{default:p((()=>[c(v,{class:"p-3 flex items-center justify-between text-[var(--theme-input-title-size)]"},{default:p((()=>[c(v,{class:"flex"},{default:p((()=>[y(g(q(F)("form.account"))+" ",1),c(v,{class:"text-rose-500"},{default:p((()=>[y("*")])),_:1})])),_:1}),"edit"==h.type?(r(),d(v,{key:0,class:"flex items-center h-[14px]"},{default:p((()=>[c(C,{modelValue:h.form.email,"onUpdate:modelValue":l[0]||(l[0]=e=>h.form.email=e),border:"none",inputAlign:"right",readonly:""},null,8,["modelValue"])])),_:1})):(r(),d(v,{key:1,class:"flex items-center h-[14px] flex-1"},{default:p((()=>[c(C,{placeholder:q(F)("input.employee_auth"),modelValue:h.form.email,"onUpdate:modelValue":l[1]||(l[1]=e=>h.form.email=e),border:"none",inputAlign:"right",placeholderStyle:"color: var(--theme-input-placeholder);text-align: end;"},null,8,["placeholder","modelValue"])])),_:1}))])),_:1}),c(j,{class:"!my-0"}),c(v,{class:"p-3 flex items-center justify-between text-[var(--theme-input-title-size)]"},{default:p((()=>[c(v,{class:"flex"},{default:p((()=>[y(g(q(F)("form.name"))+" ",1),c(v,{class:"text-rose-500"},{default:p((()=>[y("*")])),_:1})])),_:1}),c(v,{class:"flex items-center h-[14px] flex-1"},{default:p((()=>[c(C,{placeholder:q(F)("input.name"),modelValue:h.form.real_name,"onUpdate:modelValue":l[2]||(l[2]=e=>h.form.real_name=e),border:"none",inputAlign:"right",clearable:"",placeholderStyle:"color: var(--theme-input-placeholder);"},null,8,["placeholder","modelValue"])])),_:1})])),_:1}),c(j,{class:"!my-0"}),c(v,{class:"p-3 flex items-center justify-between text-[var(--theme-input-title-size)]"},{default:p((()=>[c(v,{class:"flex"},{default:p((()=>[y(g(q(F)("form.role"))+" ",1),c(v,{class:"text-rose-500"},{default:p((()=>[y("*")])),_:1})])),_:1}),c(v,{class:"flex items-center h-[14px]",onClick:l[3]||(l[3]=e=>ce.value=!0)},{default:p((()=>[c(v,{class:x(k.value?"text-[var)--theme-color-main]":"text-[var(--theme-input-placeholder)]")},{default:p((()=>[y(g(k.value?k.value:q(F)("select.role")),1)])),_:1},8,["class"]),c(z,{name:"arrow-right",color:"var(--theme-input-placeholder)",size:"13"})])),_:1})])),_:1}),"add"==h.type?(r(),d(v,{key:0,class:"p-3 flex items-center justify-between text-[var(--theme-input-title-size)]"},{default:p((()=>[c(v,{class:"flex flex-col flex-1"},{default:p((()=>[c(v,{class:"flex"},{default:p((()=>[y(g(q(F)("create_salary"))+" ",1),c(v,{class:"text-rose-500"},{default:p((()=>[y("*")])),_:1})])),_:1}),c(v,{class:"text-[var(--theme-text-blue)] text-[12px] leading-5"},{default:p((()=>[y(g(q(F)("create_salary.tips0")),1)])),_:1})])),_:1}),c(A,{inactiveColor:"var(--theme-switch-bg)",activeColor:"var(--theme-color-primary)"})])),_:1})):i("",!0),c(j,{class:"!my-0"}),c(v,{class:"p-3 flex items-center justify-between text-[var(--theme-input-title-size)]"},{default:p((()=>[c(v,{class:"flex flex-col flex-1"},{default:p((()=>[c(v,{class:"flex"},{default:p((()=>[y(g(q(F)("enabling_accounts"))+" ",1),c(v,{class:"text-rose-500"},{default:p((()=>[y("*")])),_:1})])),_:1}),c(v,{class:"text-[var(--theme-text-blue)] text-[12px] leading-4"},{default:p((()=>[y(g(q(F)("enabling_accounts.tips")),1)])),_:1})])),_:1}),c(A,{inactiveColor:"var(--theme-switch-bg)",activeColor:"var(--theme-color-primary)",activeValue:1,disabled:"add"==h.type,modelValue:h.form.status,"onUpdate:modelValue":l[4]||(l[4]=e=>h.form.status=e),onChange:ue},null,8,["disabled","modelValue"])])),_:1})])),_:1}),c(v,{class:"flex flex-col text-sm rounded m-2 bg-[#fff]"},{default:p((()=>[c(v,{class:"bg-[#fff] p-3 hidden"},{default:p((()=>[c(L,{placeholder:"请输入权限名称进行搜索",shape:"square",showAction:!1})])),_:1}),c(j,{class:"!my-0"}),c(v,{class:"p-3 flex items-center justify-between text-[var(--theme-input-title-size)]"},{default:p((()=>[c(v,{class:"flex justify-start"},{default:p((()=>[c(v,{class:"flex flex-col flex-1"},{default:p((()=>[c(v,{class:"flex justify-start items-center"},{default:p((()=>[c(v,{class:"flex items-center"},{default:p((()=>[y(g(q(F)("set_auth"))+" ",1),c(v,{class:"ml-1 mr-1 text-[var(--theme-text-red)] text-sm"},{default:p((()=>[y(" （"+g(h.roleForm.rules.length)+"/"+g(h.munuCount)+"） ",1)])),_:1})])),_:1}),c(v,null,{default:p((()=>[c(A,{inactiveColor:"var(--theme-switch-bg)",activeColor:"var(--theme-color-primary)",size:"16",activeValue:1,modelValue:h.isEnablePower,"onUpdate:modelValue":l[5]||(l[5]=e=>h.isEnablePower=e)},null,8,["modelValue"])])),_:1})])),_:1}),c(v,{class:"text-[var(--theme-text-blue)] text-[12px] leading-5"},{default:p((()=>[y(g(q(F)("set_auth.tips0")),1)])),_:1})])),_:1})])),_:1})])),_:1}),c(j,{class:"!my-0"}),c(te,{data:h.menuList,modelValue:h.roleForm.rules,"onUpdate:modelValue":l[6]||(l[6]=e=>h.roleForm.rules=e),props:{label:"menu_name",value:"menu_key",key:"id"},disabled:!h.isEnablePower},null,8,["data","modelValue","disabled"])])),_:1}),c(v,{class:"main-fix-footer bg-[#fff] z-100 grid grid-cols-2 gap-2",style:{"box-shadow":"var(--theme-box-shadow)"}},{default:p((()=>[c(H,{text:_.value,onClick:l[7]||(l[7]=e=>ne.value=!0),plain:!0,customStyle:"color: var(--theme-color-main);",iconColor:"var(--theme--color-main)",color:"var(--theme-border)"},null,8,["text"]),c(H,{text:q(F)("save"),onClick:me,color:"var(--theme-color-primary)"},null,8,["text"])])),_:1})])),_:1},8,["style"]),c(J,{show:ne.value,"onUpdate:show":l[9]||(l[9]=e=>ne.value=e),width:300,showConfirmButton:!1,contentTextAlign:"center"},{confirmButton:p((()=>[c(v,{class:"flex gap-3"},{default:p((()=>[c(H,{onClick:l[8]||(l[8]=e=>ne.value=!1),class:"!text-[#303133]",color:"#f4f5f7",text:q(F)("cancel")},null,8,["text"]),c(H,{text:q(F)("OK"),onClick:fe,color:"#e0b87a"},null,8,["text"])])),_:1})])),default:p((()=>[c(v,{class:"!box-border w-full text-[var(--theme-color-main)] text-center"},{default:p((()=>[y(g(q(F)("update_and_save")),1)])),_:1})])),_:1},8,["show"]),c(ee,{show:ce.value,mode:"bottom",onClose:l[13]||(l[13]=e=>ce.value=!1),onOpen:l[14]||(l[14]=()=>{}),class:"custom-popup"},{default:p((()=>[c(v,{class:"p-3 flex justify-between items-center"},{default:p((()=>[c(v),c(v,{class:"flex !text-center font-bold text-[30rpx]"},{default:p((()=>[y(g(q(F)("select.role")),1)])),_:1}),c(z,{name:"close",size:"15",onClick:l[10]||(l[10]=e=>ce.value=!1)})])),_:1}),c(M),c(v,{class:"p-3 mb-5"},{default:p((()=>[c(v,{class:"mb-2 flex justify-between items-center"},{default:p((()=>[c(v,{class:"text-xs text-[var(--theme-color-tips)]"},{default:p((()=>[y(g(q(F)("left_slide_delete_role")),1)])),_:1}),c(v,{class:"flex justify-end items-center",onClick:l[11]||(l[11]=e=>de.value=!0)},{default:p((()=>[c(z,{name:"plus-circle-fill",color:"var(--theme-color-primary)",size:"15"}),c(v,{class:"h-[17px] text-xs text-[var(--theme-color-primary)] ml-1"},{default:p((()=>[y(g(q(F)("add_role")),1)])),_:1})])),_:1})])),_:1}),(r(!0),n(u,null,w(h.roleList,((e,a)=>(r(),d(X,{key:a,class:"mt-[10px] mb-[10px]"},{default:p((()=>[c(Q,{options:re,onClick:l=>((e,l)=>{G({role_id:e.role_id}).then((e=>{V({title:F("delete_success"),icon:"none"}),h.roleList.splice(l,1)})).catch((()=>{V({title:F("delete_error"),icon:"none"})}))})(e,a)},{default:p((()=>[c(Z,{modelValue:h.roleForm.role_id,"onUpdate:modelValue":l[12]||(l[12]=e=>h.roleForm.role_id=e),placement:"column",iconPlacement:"right",onChange:l=>(async({role_id:e})=>{h.form.role_ids=[e],ce.value=!1,h.loading=!0,await b(),h.loading=!1})(e),size:"15",activeColor:"var(--theme-color-primary)",shape:"circle"},{default:p((()=>[c(Y,{labelColor:"#333",labelSize:"14",label:e.role_name,name:e.role_id},null,8,["label","name"])])),_:2},1032,["modelValue","onChange"])])),_:2},1032,["options","onClick"])])),_:2},1024)))),128))])),_:1})])),_:1},8,["show"]),c(J,{show:de.value,"onUpdate:show":l[17]||(l[17]=e=>de.value=e),width:300,showConfirmButton:!1,contentTextAlign:"center"},{confirmButton:p((()=>[c(v,{class:"flex gap-3"},{default:p((()=>[c(H,{onClick:l[16]||(l[16]=e=>de.value=!1),class:"!text-[#303133]",color:"#f4f5f7",text:q(F)("cancel")},null,8,["text"]),c(H,{text:q(F)("OK"),onClick:oe,color:"#e0b87a"},null,8,["text"])])),_:1})])),default:p((()=>[c(v,{class:"flex flex-col items-center w-full"},{default:p((()=>[c(v,{class:"flex !text-center font-bold text-base mb-3"},{default:p((()=>[y(g(q(F)("add_role")),1)])),_:1}),c(v,{class:"flex flex-col !box-border w-full !bg-[#f4f5f7] p-2 !rounded"},{default:p((()=>[c(C,{placeholder:q(F)("input.role_name"),border:"none",modelValue:h.roleForm.role_name,"onUpdate:modelValue":l[15]||(l[15]=e=>h.roleForm.role_name=e),inputAlign:"center",clearable:""},null,8,["placeholder","modelValue"])])),_:1})])),_:1})])),_:1},8,["show"]),c(le,{loading:h.loading},null,8,["loading"])],64)}}}),[["__scopeId","data-v-87f7b08a"]]);export{oe as default};
