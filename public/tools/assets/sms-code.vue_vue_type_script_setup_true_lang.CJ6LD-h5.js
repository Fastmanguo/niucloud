import{r as e,s as a,E as t,ae as o,af as c,d as n,W as l,b as s,e as r,ag as i,Y as u,ah as d,a5 as m,o as p,f as h,w as f,p as g,t as v,u as x,a7 as y,i as C,P as _,a6 as b,K as w}from"./index-DlbBJ3bC.js";const k=n({__name:"sms-code",props:{mobile:String,type:String,isAgree:{type:Boolean,default:!0},modelValue:{type:String,default:""}},emits:["update:modelValue"],setup(n,{emit:k}){const V=n,G=k,T=t({get:()=>V.modelValue,set(e){G("update:modelValue",e)}}),E=e(null),P=function(c){const n=e(a("getSmsCode")),l="X"+a("smsCodeChangeText"),s=t((()=>!c.value||c.value.canGetCode));return{tips:n,seconds:90,canGetCode:s,send:async e=>{if(!s.value)return;c.value.start();let a=!1;return await o(e).then((e=>{1==e.code?a=e.data.key:(c.value.reset(),a=!1)})).catch((e=>{a=!1,c.value.reset()})),a},codeChange:e=>{n.value=e},changeText:l}}(E),S=e(!1),A=l({mobile:"",captcha_code:"",captcha_key:"",type:V.type}),$=function(a){const t=e("");return{image:t,refresh:async()=>{try{const e=await c();a.captcha_key=e.data.captcha_key,a.captcha_code="",t.value=e.data.img.replace(/\r\n/g,"")}catch(e){}}}}(A),j=async()=>{if(E.value.canGetCode){if(A.mobile=V.mobile,!V.isAgree)return void w({title:a("isAgreeTips"),icon:"none"});if(uni.$u.test.isEmpty(A.mobile))return void w({title:a("mobilePlaceholder"),icon:"none"});if(!uni.$u.test.mobile(A.mobile))return void w({title:a("mobileError"),icon:"none"});await $.refresh(),S.value=!0}},B=async()=>{if(uni.$u.test.isEmpty(A.captcha_code))return void w({title:a("captchaPlaceholder"),icon:"none"});const e=await P.send(A);e?(T.value=e,S.value=!1):!1===e&&$.refresh()};return(e,t)=>{const o=C,c=s(r("u-code"),i),n=s(r("u-input"),u),l=_,w=s(r("u-modal"),d);return p(),m(b,null,[h(o,{class:y(["text-[26rpx]",{"text-primary":x(P).canGetCode.value,"text-gray-300":!x(P).canGetCode.value}]),onClick:j},{default:f((()=>[g(v(x(P).tips.value),1)])),_:1},8,["class"]),h(c,{seconds:x(P).seconds,"change-text":x(P).changeText,ref_key:"smsRef",ref:E,onChange:x(P).codeChange},null,8,["seconds","change-text","onChange"]),h(w,{show:S.value,title:x(a)("captchaTitle"),"confirm-text":x(a)("confirm"),"cancel-text":x(a)("cancel"),"show-cancel-button":!0,onCancel:t[2]||(t[2]=e=>S.value=!1),onConfirm:B,confirmColor:"var(--primary-color)"},{default:f((()=>[h(o,{class:"flex mt-[20rpx]"},{default:f((()=>[h(n,{placeholder:x(a)("captchaPlaceholder"),border:"surround",modelValue:A.captcha_code,"onUpdate:modelValue":t[0]||(t[0]=e=>A.captcha_code=e)},null,8,["placeholder","modelValue"]),h(l,{src:x($).image.value,class:"h-[76rpx] w-[auto] ml-[20rpx]",mode:"heightFix",onClick:t[1]||(t[1]=e=>x($).refresh())},null,8,["src"])])),_:1})])),_:1},8,["show","title","confirm-text","cancel-text"])],64)}}});export{k as _};
