import{d as e,r as t,y as a,S as l,a7 as s,b as u,l as i,c as r,aW as o,o as p,e as d,w as f,f as n,bu as m,i as c,n as y,p as g,t as h,h as x,K as v,c4 as b,b0 as S,c7 as T}from"./index-VHk1sExB.js";const F=e({__name:"index",props:{text:{type:String,default:""},modelValue:{type:[String,Array],default:()=>null},valueType:{type:String,default:"string"},resultType:{type:String,default:"string"},afterFormatter:{type:Function,default:e=>e},beforeFormatter:{type:Function,default:e=>e},autoUpload:{type:Boolean,default:!0},fileType:{type:String,default:"image"},width:{type:[Number,String],default:80},height:{type:[Number,String],default:80},edit:{type:Boolean,default:!0},max:{type:Number,default:1},min:{type:Number,default:0},iconSize:{type:[Number,String],default:24},tipsSize:{type:[Number,String],default:12},tips:{type:String,default:""}},emits:["update:modelValue","uploadAfter","uploadBefore","upload"],setup(e,{expose:F,emit:_}){const w=e,z=t(),j=_;a({get:()=>w.modelValue,set(e){j("update:modelValue",w.formatter(e))}});const N=l({data:[],dataUpload:[],temp:{},edit:!1,max:0}),V=e=>void 0!==B[e]?{url:B[e],value:e,status:""}:{url:v(e),value:e,status:""},B={},k=a({get(){let e=[...N.data,...Object.values(N.temp)];return w.edit?N.max=w.max:N.max=e.length,e},set(e){}}),A=e=>{console.log("读取前"),console.log(e)},E=b((e=>{if(w.autoUpload){const t=N.temp[e];j("uploadAfter",t),t.status="uploading";("image"==w.fileType?S:T)({filePath:t.url,name:"file"}).then((({data:e})=>{t.value=e.url,B[e.url]=t.url,t.status="success"})).catch((e=>{t.status="failed",t.message=e.msg})).finally((()=>{R()}))}}),200),R=b((()=>{let e=[];Object.keys(N.temp).forEach((t=>{"success"==N.temp[t].status&&(e.push(N.temp[t].value),delete N.temp[t])})),N.data.forEach((t=>{e.push(t.value)})),"string"==w.valueType&&(e=e.join(",")),j("update:modelValue",w.afterFormatter(e))}),100),O=({file:e})=>{e.forEach((e=>{console.log(e);const t={url:e.url,file:e,value:null,status:"",message:""};N.temp[e.name]=t,E(e.name)}))},U=e=>{if(""==e.file.status)for(let t=0;t<N.data.length;t++)N.data[t].value==e.file.value&&N.data.splice(t,1);else Object.keys(N.temp).forEach((t=>{N.temp[t].url==e.file.url&&delete N.temp[t]}));R()};return s((()=>w.modelValue),(e=>{let t=w.beforeFormatter(e),a=[];if(!t||"string"==w.valueType&&""==t||"array"==w.valueType&&!t.length)return[];if("string"==w.valueType)if(w.max>1){a=t.split(",").map((e=>V(e)))}else a=[V(t)];else"array"==w.valueType&&(a=t.map((e=>V(e))));N.data=a}),{deep:!0,immediate:!0}),F({chooseFile:()=>{z.value.chooseFile()}}),(e,t)=>{const a=u(r("up-icon"),i),l=c,s=u(r("up-upload"),o);return p(),d(l,{class:"upload-file"},{default:f((()=>[n(s,{ref_key:"uploadRef",ref:z,deletable:w.edit,useBeforeRead:!1,fileList:k.value,maxCount:N.max,accept:w.fileType,onAfterRead:O,onBeforeRead:A,onDelete:U,width:w.width,height:w.height,name:"1",multiple:""},{default:f((()=>[m(e.$slots,"default",{},(()=>[n(l,{class:"flex flex-col justify-center items-center bg-[#f4f5f7]",style:y({width:w.width+"px",height:w.height+"px"})},{default:f((()=>[n(a,{size:w.iconSize,name:"camera-fill",color:"var(--theme-color-primary)"},null,8,["size"]),w.tips?(p(),d(l,{key:0,class:"text-[#999]",style:y({fontSize:w.tipsSize+"px"})},{default:f((()=>[g(h(w.tips),1)])),_:1},8,["style"])):x("",!0)])),_:1},8,["style"])]))])),_:3},8,["deletable","fileList","maxCount","accept","width","height"])])),_:3})}}});export{F as _};
