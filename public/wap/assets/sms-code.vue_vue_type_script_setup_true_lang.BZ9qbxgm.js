import{r as e,s as a,y as t,a9 as c,aa as o,d as n,S as l,b as s,ab as r,c as i,U as u,ac as d,o as m,a0 as p,f as h,w as f,p as g,t as v,u as y,a2 as x,a1 as C,E as _,i as b,L as w}from"./index-VHk1sExB.js";const k=n({__name:"sms-code",props:{mobile:String,type:String,isAgree:{type:Boolean,default:!0},modelValue:{type:String,default:""}},emits:["update:modelValue"],setup(n,{emit:k}){const V=n,G=k,S=t({get:()=>V.modelValue,set(e){G("update:modelValue",e)}}),T=e(null),E=function(o){const n=e(a("getSmsCode")),l="X"+a("smsCodeChangeText"),s=t((()=>!o.value||o.value.canGetCode));return{tips:n,seconds:90,canGetCode:s,send:async e=>{if(!s.value)return;o.value.start();let a=!1;return await c(e).then((e=>{1==e.code?a=e.data.key:(o.value.reset(),a=!1)})).catch((e=>{a=!1,o.value.reset()})),a},codeChange:e=>{n.value=e},changeText:l}}(T),A=e(!1),P=l({mobile:"",captcha_code:"",captcha_key:"",type:V.type}),$=function(a){const t=e("");return{image:t,refresh:async()=>{try{const e=await o();a.captcha_key=e.data.captcha_key,a.captcha_code="",t.value=e.data.img.replace(/\r\n/g,"")}catch(e){}}}}(P),U=async()=>{if(T.value.canGetCode){if(P.mobile=V.mobile,!V.isAgree)return void _({title:a("isAgreeTips"),icon:"none"});if(uni.$u.test.isEmpty(P.mobile))return void _({title:a("mobilePlaceholder"),icon:"none"});if(!uni.$u.test.mobile(P.mobile))return void _({title:a("mobileError"),icon:"none"});await $.refresh(),A.value=!0}},j=async()=>{if(uni.$u.test.isEmpty(P.captcha_code))return void _({title:a("captchaPlaceholder"),icon:"none"});const e=await E.send(P);e?(S.value=e,A.value=!1):!1===e&&$.refresh()};return(e,t)=>{const c=b,o=s(i("u-code"),r),n=s(i("u-input"),u),l=w,_=s(i("u-modal"),d);return m(),p(C,null,[h(c,{class:x(["text-[26rpx]",{"text-primary":y(E).canGetCode.value,"text-gray-300":!y(E).canGetCode.value}]),onClick:U},{default:f((()=>[g(v(y(E).tips.value),1)])),_:1},8,["class"]),h(o,{seconds:y(E).seconds,"change-text":y(E).changeText,ref_key:"smsRef",ref:T,onChange:y(E).codeChange},null,8,["seconds","change-text","onChange"]),h(_,{show:A.value,title:y(a)("captchaTitle"),"confirm-text":y(a)("confirm"),"cancel-text":y(a)("cancel"),"show-cancel-button":!0,onCancel:t[2]||(t[2]=e=>A.value=!1),onConfirm:j,confirmColor:"var(--primary-color)"},{default:f((()=>[h(c,{class:"flex mt-[20rpx]"},{default:f((()=>[h(n,{placeholder:y(a)("captchaPlaceholder"),border:"surround",modelValue:P.captcha_code,"onUpdate:modelValue":t[0]||(t[0]=e=>P.captcha_code=e)},null,8,["placeholder","modelValue"]),h(l,{src:y($).image.value,class:"h-[76rpx] w-[auto] ml-[20rpx]",mode:"heightFix",onClick:t[1]||(t[1]=e=>y($).refresh())},null,8,["src"])])),_:1})])),_:1},8,["show","title","confirm-text","cancel-text"])],64)}}});export{k as _};
