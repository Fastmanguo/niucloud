import{d as t,r as e,S as a,b as o,l as s,c as l,bY as i,U as c,$ as n,m as d,aO as r,o as u,e as p,w as f,f as m,p as _,a0 as x,am as h,a1 as g,E as y,cf as b,bX as w,cg as v,s as k,i as S,t as V,u as j,K as C,I as U,c3 as $,h as z,c5 as F}from"./index-VHk1sExB.js";import{c as L}from"./custom-cost-item.BBW2JDad.js";import{d as A,g as E}from"./goods.w7yS6gCV.js";const I=t({__name:"custom-cost",emits:["close","confirm"],setup(t,{expose:I,emit:D}){const K=e(),O=a({isShow:!1,data:{},id:"",type:"",other:{},btnLoading:!1}),R=e([]);I({open:async t=>{let e=t.id,a=t.type,o=t.other||{};if(O.btnLoading=!1,!e||!a)return void y({title:"参数错误",icon:"none"});O.id=e,O.type=a,O.other=o;const s="goods"==a?E:"";b(),0==R.value.length&&await w("cost_type").then((({data:t})=>{R.value=t.list})),await s(O.id).then((({data:t})=>{O.data=t})),v(),O.isShow=!0}});const X=D,Y=()=>{b();let t={goods_id:O.id,total_cost:O.data.total_cost,initial_cost:O.data.initial_cost,additional_total_cost:O.data.additional_total_cost,goods_cost:O.data.goods_cost};A(t).then((()=>{v(),y({title:k("success"),icon:"none"}),X("confirm",O.other),O.isShow=!1})).finally((()=>{v()}))},q=()=>{let t=0;O.data.goods_cost.forEach((e=>{t+=parseFloat(e.money)})),O.data.additional_total_cost=F(t),O.data.total_cost=F(parseFloat(O.data.initial_cost||0)+parseFloat(O.data.additional_total_cost))},B=t=>{O.data.goods_cost.splice(t,1),q()},G=(t,e)=>{void 0===e?O.data.goods_cost.push(t):O.data.goods_cost[e]=t,q()};return(t,e)=>{const a=S,y=o(l("up-icon"),s),b=o(l("up-line"),i),w=o(l("up-input"),c),v=o(l("up-button"),n),k=o(l("up-image"),d),F=o(l("up-popup"),r);return u(),p(a,null,{default:f((()=>[m(F,{show:O.isShow,mode:"bottom"},{default:f((()=>[m(a,{class:"p-4 flex justify-between items-center"},{default:f((()=>[m(a),m(a,{class:"flex !text-center font-bold text-[30rpx]"},{default:f((()=>[_("添加附加成本")])),_:1}),m(y,{name:"close",size:"15",onClick:e[0]||(e[0]=t=>O.isShow=!1)})])),_:1}),m(b),m(a,{class:"p-3 flex items-between flex-col text-[28rpx]"},{default:f((()=>[m(a,{class:"flex items-center justify-between"},{default:f((()=>[m(a,{class:"flex"},{default:f((()=>[_(" 总成本 ")])),_:1}),m(a,{class:"flex-1 items-center ml-5"},{default:f((()=>[m(w,{color:"var(--theme-color-tips)",readonly:"",placeholder:"请输入总成本",border:"none",modelValue:O.data.total_cost,"onUpdate:modelValue":e[1]||(e[1]=t=>O.data.total_cost=t),placeholderStyle:"color: #c0c4cc;font-size:25rpx;"},null,8,["modelValue"])])),_:1})])),_:1}),m(a,{class:"mt-3 bg-[#f9fafb] my-[10rpx]"},{default:f((()=>[m(a,{class:"p-3 flex items-center justify-between text-[28rpx]"},{default:f((()=>[m(a,{class:"flex text-[#909399]"},{default:f((()=>[_(" 原始总成本 ")])),_:1}),m(a,{class:"flex items-center h-[14px]"},{default:f((()=>[m(w,{color:"var(--theme-color-tips)",readonly:"",border:"none",modelValue:O.data.initial_cost,"onUpdate:modelValue":e[2]||(e[2]=t=>O.data.initial_cost=t),inputAlign:"right"},null,8,["modelValue"])])),_:1})])),_:1}),m(b),m(a,{class:"p-3 flex items-center justify-between text-[28rpx]"},{default:f((()=>[m(a,{class:"flex text-[#909399]"},{default:f((()=>[_(" 附加总成本 ")])),_:1}),m(a,{class:"flex items-center h-[14px]"},{default:f((()=>[m(w,{modelValue:"0",color:"var(--theme-color-tips)",readonly:"","onUpdate:modelValue":e[3]||(e[3]=t=>O.data.additional_total_cost=t),border:"none",inputAlign:"right"},null,8,["modelValue"])])),_:1})])),_:1}),m(a,{class:"p-3 py-2"},{default:f((()=>[m(v,{text:"添加附加成本",onClick:e[4]||(e[4]=t=>K.value.open()),color:"#e0b87a",plain:"",size:"small",icon:"plus",iconColor:"#e0b87a"})])),_:1}),(u(!0),x(g,null,h(O.data.goods_cost,((t,e)=>(u(),p(a,{class:"p-3 py-2 text-[24rpx] text-[#606266]",key:`cost_index_${e}`},{default:f((()=>[m(a,{class:"p-3 py-2 text-[24rpx] text-[#606266] flex justify-between item-center"},{default:f((()=>[_(V(t.cost_name)+" ",1),m(a,{class:"text-[var(--theme-color-primary)]"},{default:f((()=>[_(V(t.money),1)])),_:2},1024)])),_:2},1024),t.images&&t.images.length>0?(u(),p(a,{key:0,class:"p-3 pt-1 flex"},{default:f((()=>[(u(!0),x(g,null,h(t.images,((o,s)=>(u(),p(a,{key:`im_${e}_${s}`},{default:f((()=>[m(k,{"show-loading":!0,src:j(C)(o),width:"50px",height:"50px",onClick:U((e=>j($)(t.images,s)),["stop"]),radius:"5px",class:"mr-[20rpx]"},null,8,["src","onClick"])])),_:2},1024)))),128))])),_:2},1024)):z("",!0)])),_:2},1024)))),128))])),_:1}),m(a,{class:"flex gap-3 main-fix-footer !relative mt-[10px]"},{default:f((()=>[m(v,{class:"!text-[#606266]",color:"#909399",plain:"",text:"取消",onClick:e[5]||(e[5]=t=>O.isShow=!1)}),m(v,{text:"保存",color:"var(--theme-color-primary)",onClick:Y,loading:O.btnLoading},null,8,["loading"])])),_:1})])),_:1})])),_:1},8,["show"]),m(L,{ref_key:"customCostItemRef",ref:K,list:R.value,onSubmit:G,onDelete:B},null,8,["list"])])),_:1})}}});export{I as _};
