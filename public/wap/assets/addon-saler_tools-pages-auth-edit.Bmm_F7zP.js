import{d as e,r as l,y as a,b as t,l as o,c as s,o as n,a0 as r,f as u,w as c,e as d,g as i,v as m,h as f,I as p,a2 as h,p as _,t as v,n as x,a1 as b,am as y,i as g,cL as w,_ as k,a7 as C,E as V,S as j,s as F,B as z,F as A,x as L,U,ce as E,bl as O,c8 as B,$ as N,ac as I,bY as P,b$ as S,c0 as $,b6 as T,cE as K,aO as R,u as q,Q as M}from"./index-VHk1sExB.js";import{_ as Q}from"./loading-page.vue_vue_type_script_setup_true_lang._vb0LNCj.js";import{b as Y,c as D,d as G,e as H,l as J,u as W,f as X,h as Z,i as ee,j as le}from"./auth.CqjcWN4L.js";const ae=k(e({__name:"tree",props:{node:{type:Object,default:()=>{}},props:{type:Object,default:()=>{}},checkedValue:{type:Array,default:()=>[]},level:{type:Number,default:0},parent:{type:[Object,null],default:()=>null},disabled:{type:Boolean,default:!1}},emits:["changeNode"],setup(e,{emit:k}){const C=e,V=l(!1),j=l([]),F=a((()=>{let e=C.node[C.props.children];return!!(e&&e.length>0)&&(j.value=e,!0)})),z=a((()=>{var e;return null==(e=C.checkedValue)?void 0:e.includes(C.node[C.props.value])})),A=k,L=()=>{let e=[];C.parent&&(e=[C.parent]),A("changeNode",C.node,e)},U=(e,l)=>{let a=l;C.parent&&(a=[C.parent,...l]),A("changeNode",e,a)},E=a((()=>function e(l){let a=1;if(l[C.props.children]&&l[C.props.children].length>0)for(const t of l[C.props.children])a+=e(t);return a}(C.node))),O=a((()=>function e(l,a){let t=0;if(a.includes(l[C.props.value])&&t++,l[C.props.children]&&l[C.props.children].length>0)for(const o of l[C.props.children])t+=e(o,a);return t}(C.node,C.checkedValue)));return(l,a)=>{const k=t(s("up-icon"),o),A=g,B=w;return n(),r(b,null,[u(A,{class:"tree-item",style:x({paddingLeft:20*C.level+(F.value?0:26)+"px"})},{default:c((()=>[u(A,{class:"tree-label"},{default:c((()=>[F.value?(n(),d(A,{key:0},{default:c((()=>[u(A,{class:"option-icon",onClick:a[0]||(a[0]=e=>V.value=!V.value)},{default:c((()=>[i(u(k,{name:"minus",color:"var(--theme-color-main)"},null,512),[[m,V.value]]),i(u(k,{name:"plus",color:"var(--theme-color-main)"},null,512),[[m,!V.value]])])),_:1})])),_:1})):f("",!0),u(B,{onClick:p(L,["stop"]),disabled:C.disabled,checked:z.value,style:{transform:"scale(0.85)"},color:"#fff",class:h(["rounded-[2px] mr-1 w-22px h-22px flex items-center justify-center",C.disabled?"bg-[var(--theme-border)]":z.value?"bg-[var(--theme-color-primary)]":""])},null,8,["disabled","checked","class"]),u(A,{onClick:p(L,["stop"]),class:h(z.value?"text-[var(--theme-color-primary)]":"text-[var(--theme--color-main)]")},{default:c((()=>[_(v(C.node[C.props.label]),1)])),_:1},8,["class"]),F.value?(n(),d(A,{key:1,class:"ml-2 text-[var(--theme-text-red)] text-sm"},{default:c((()=>[_(" ("+v(O.value)+"/"+v(E.value)+") ",1)])),_:1})):f("",!0)])),_:1}),F.value?(n(),d(A,{key:0,class:"tree-expand",onClick:a[1]||(a[1]=p((e=>V.value=!V.value),["stop"]))},{default:c((()=>[_(v(V.value?"收起":"展开"),1)])),_:1})):f("",!0)])),_:1},8,["style"]),F.value&&V.value?(n(),d(A,{key:0},{default:c((()=>[(n(!0),r(b,null,y(j.value,((l,a)=>(n(),d(ae,{key:a,props:C.props,node:l,"checked-value":C.checkedValue,level:C.level+1,parent:e.node,onChangeNode:U},null,8,["props","node","checked-value","level","parent"])))),128))])),_:1})):f("",!0)],64)}}}),[["__scopeId","data-v-7f017c46"]]),te=e({__name:"index",props:{data:{type:Array,default:[]},modelValue:{type:Array,default:[]},props:{type:Object,default:()=>{}},disabled:{type:Boolean,default:!1},checkedValue:{type:Array,default:()=>[]}},emits:["update:modelValue"],setup(e,{emit:t}){const o=e,s=l([]),u=l([]);C((()=>o.modelValue),(()=>{u.value=o.modelValue}),{deep:!0,immediate:!0});const i=e=>{u.value.includes(e)||u.value.push(e)},m=e=>{let l=e[h.value.value],a=e[h.value.children];(e=>{let l;-1!==(l=u.value.indexOf(e))&&u.value.splice(l,1)})(l),a&&a.length>0&&a.forEach((e=>{m(e)}))},f=e=>{let l=e[h.value.value],a=e[h.value.children];i(l),a&&a.length>0&&a.forEach((e=>{f(e)}))},p=(e,l)=>{if(o.disabled)return void V({title:"请开启【设置权限】按钮再进行权限设置",icon:"none"});console.log("handleChangeNode",e,l);let a=e[h.value.value];u.value.includes(a)?m(e):(f(e),l&&l.length>0&&l.forEach((e=>{e&&i(e[h.value.value])})))},h=a((()=>({lebel:"label",value:"value",children:"children",...o.props}))),_=a((()=>{const e=o.data;return s.value=e,!s.value||0===s.value.length}));return(e,l)=>{const a=g;return _.value?(n(),d(a,{key:0})):(n(),d(a,{key:1},{default:c((()=>[(n(!0),r(b,null,y(s.value,((e,l)=>(n(),d(ae,{key:l,props:h.value,node:e,"checked-value":u.value,level:1,onChangeNode:p,disabled:o.disabled},null,8,["props","node","checked-value","disabled"])))),128))])),_:1}))}}}),oe=k(e({__name:"edit",setup(e){const i=j({loading:!0,type:"",uid:0,roleForm:{role_name:"",rules:[]},roleList:[],form:{},isEnablePower:1,showAll:!1,collapseRef:null,sonItemRef:null,menuList:[],munuCount:0}),m=l(`${F("update")}${i.roleForm.real_name?i.roleForm.real_name:F("shop_manager")}${F("auth_and_save")}`),p=async()=>{i.uid?(await Y(i.uid).then((e=>{i.form=e.data})).catch((e=>{V({title:e.msg,icon:"none"})})),1==i.form.is_admin&&M({title:F("unable_edit_super_admin"),url:"/addon/saler_tools/pages/auth/list"}),i.form.role_ids.length>0&&await w(),i.loading=!1):i.loading=!1},w=()=>D(i.form.role_ids[0]).then((e=>{i.roleForm=e.data})).catch((e=>{V({title:e.msg,icon:"none"})})),k=a({get:()=>{if(!(i.form.role_ids&&i.form.role_ids.length>0))return!1;{let e=i.form.role_ids[0];for(let l=0;l<i.roleList.length;l++){const a=i.roleList[l];if(a.role_id==e)return a.role_name}}},set:()=>{}});C((()=>i.menuList),(()=>{i.munuCount=0,ae(i.menuList)}),{deep:!0,immediate:!1});const ae=e=>e.forEach((e=>(i.munuCount++,e.children&&ae(e.children)))),oe=()=>{G(i.roleForm).then((e=>{V({title:F("add_success"),icon:"none"}),i.roleForm.role_name="",se()})).catch((()=>{V({title:F("add_error"),icon:"none"})})).finally((()=>{de.value=!1}))},se=()=>{H().then((e=>{i.roleList=e.data}))},ne=l(!1),re=j([{text:F("delete")}]),ue=e=>{0==e?J(i.form.uid).then((e=>{V({icon:"none",title:e.msg})})).catch((e=>{V({icon:"none",title:e.msg})})):W(i.form.uid).then((e=>{V({icon:"none",title:e.msg})})).catch((e=>{V({icon:"none",title:e.msg})}))},ce=l(!1),de=l(!1),ie=()=>{X().then((e=>{i.menuList=e.data}))},me=async()=>{let e;e=await Z(i.roleForm),1==e.code&&(e=await ee(i.form),1==e.code?(w(),V({title:F("save_success"),icon:"none"})):V({title:F("save_timeout"),icon:"none"}))},fe=()=>{Z(i.roleForm).then((e=>{V({title:F("save_auth_set_success"),icon:"none"})})).catch((()=>{V({title:F("save_auth_set_error"),icon:"none"})})).finally((()=>{ne.value=!1}))};return z((e=>{i.uid=e.uid,i.type=e.type,se(),p(),ie()})),A((()=>{se(),p(),ie()})),(e,l)=>{const a=t(s("up-navbar"),L),p=g,C=t(s("up-input"),U),j=t(s("up-divider"),E),z=t(s("up-icon"),o),A=t(s("up-switch"),O),M=t(s("up-search"),B),Y=t(s("up-button"),N),D=t(s("up-modal"),I),G=t(s("up-line"),P),H=t(s("up-radio"),S),J=t(s("up-radio-group"),$),W=t(s("up-swipe-action-item"),T),X=t(s("up-swipe-action"),K),Z=t(s("up-popup"),R),ee=t(s("loading-page"),Q);return n(),r(b,null,[u(p,{style:x(e.themeColor()),class:"main-fix-footer-safe"},{default:c((()=>[u(a,{title:"add"==i.type?q(F)("add_employee"):q(F)("edit_employee"),autoBack:!0,safeAreaInsetTop:!0,placeholder:!0},null,8,["title"]),u(p,{class:"flex flex-col text-sm rounded m-2 bg-[#fff]"},{default:c((()=>[u(p,{class:"p-3 flex items-center justify-between text-[var(--theme-input-title-size)]"},{default:c((()=>[u(p,{class:"flex"},{default:c((()=>[_(v(q(F)("form.account"))+" ",1),u(p,{class:"text-rose-500"},{default:c((()=>[_("*")])),_:1})])),_:1}),"edit"==i.type?(n(),d(p,{key:0,class:"flex items-center h-[14px]"},{default:c((()=>[u(C,{modelValue:i.form.email,"onUpdate:modelValue":l[0]||(l[0]=e=>i.form.email=e),border:"none",inputAlign:"right",readonly:""},null,8,["modelValue"])])),_:1})):(n(),d(p,{key:1,class:"flex items-center h-[14px] flex-1"},{default:c((()=>[u(C,{placeholder:q(F)("input.employee_auth"),modelValue:i.form.email,"onUpdate:modelValue":l[1]||(l[1]=e=>i.form.email=e),border:"none",inputAlign:"right",placeholderStyle:"color: var(--theme-input-placeholder);text-align: end;"},null,8,["placeholder","modelValue"])])),_:1}))])),_:1}),u(j,{class:"!my-0"}),u(p,{class:"p-3 flex items-center justify-between text-[var(--theme-input-title-size)]"},{default:c((()=>[u(p,{class:"flex"},{default:c((()=>[_(v(q(F)("form.name"))+" ",1),u(p,{class:"text-rose-500"},{default:c((()=>[_("*")])),_:1})])),_:1}),u(p,{class:"flex items-center h-[14px] flex-1"},{default:c((()=>[u(C,{placeholder:q(F)("input.name"),modelValue:i.form.real_name,"onUpdate:modelValue":l[2]||(l[2]=e=>i.form.real_name=e),border:"none",inputAlign:"right",clearable:"",placeholderStyle:"color: var(--theme-input-placeholder);"},null,8,["placeholder","modelValue"])])),_:1})])),_:1}),u(j,{class:"!my-0"}),u(p,{class:"p-3 flex items-center justify-between text-[var(--theme-input-title-size)]"},{default:c((()=>[u(p,{class:"flex"},{default:c((()=>[_(v(q(F)("form.role"))+" ",1),u(p,{class:"text-rose-500"},{default:c((()=>[_("*")])),_:1})])),_:1}),u(p,{class:"flex items-center h-[14px]",onClick:l[3]||(l[3]=e=>ce.value=!0)},{default:c((()=>[u(p,{class:h(k.value?"text-[var)--theme-color-main]":"text-[var(--theme-input-placeholder)]")},{default:c((()=>[_(v(k.value?k.value:q(F)("select.role")),1)])),_:1},8,["class"]),u(z,{name:"arrow-right",color:"var(--theme-input-placeholder)",size:"13"})])),_:1})])),_:1}),"add"==i.type?(n(),d(p,{key:0,class:"p-3 flex items-center justify-between text-[var(--theme-input-title-size)]"},{default:c((()=>[u(p,{class:"flex flex-col flex-1"},{default:c((()=>[u(p,{class:"flex"},{default:c((()=>[_(v(q(F)("create_salary"))+" ",1),u(p,{class:"text-rose-500"},{default:c((()=>[_("*")])),_:1})])),_:1}),u(p,{class:"text-[var(--theme-text-blue)] text-[12px] leading-5"},{default:c((()=>[_(v(q(F)("create_salary.tips0")),1)])),_:1})])),_:1}),u(A,{inactiveColor:"var(--theme-switch-bg)",activeColor:"var(--theme-color-primary)"})])),_:1})):f("",!0),u(j,{class:"!my-0"}),u(p,{class:"p-3 flex items-center justify-between text-[var(--theme-input-title-size)]"},{default:c((()=>[u(p,{class:"flex flex-col flex-1"},{default:c((()=>[u(p,{class:"flex"},{default:c((()=>[_(v(q(F)("enabling_accounts"))+" ",1),u(p,{class:"text-rose-500"},{default:c((()=>[_("*")])),_:1})])),_:1}),u(p,{class:"text-[var(--theme-text-blue)] text-[12px] leading-4"},{default:c((()=>[_(v(q(F)("enabling_accounts.tips")),1)])),_:1})])),_:1}),u(A,{inactiveColor:"var(--theme-switch-bg)",activeColor:"var(--theme-color-primary)",activeValue:1,disabled:"add"==i.type,modelValue:i.form.status,"onUpdate:modelValue":l[4]||(l[4]=e=>i.form.status=e),onChange:ue},null,8,["disabled","modelValue"])])),_:1})])),_:1}),u(p,{class:"flex flex-col text-sm rounded m-2 bg-[#fff]"},{default:c((()=>[u(p,{class:"bg-[#fff] p-3 hidden"},{default:c((()=>[u(M,{placeholder:"请输入权限名称进行搜索",shape:"square",showAction:!1})])),_:1}),u(j,{class:"!my-0"}),u(p,{class:"p-3 flex items-center justify-between text-[var(--theme-input-title-size)]"},{default:c((()=>[u(p,{class:"flex justify-start"},{default:c((()=>[u(p,{class:"flex flex-col flex-1"},{default:c((()=>[u(p,{class:"flex justify-start items-center"},{default:c((()=>[u(p,{class:"flex items-center"},{default:c((()=>[_(v(q(F)("set_auth"))+" ",1),u(p,{class:"ml-1 mr-1 text-[var(--theme-text-red)] text-sm"},{default:c((()=>[_(" （"+v(i.roleForm.rules.length)+"/"+v(i.munuCount)+"） ",1)])),_:1})])),_:1}),u(p,null,{default:c((()=>[u(A,{inactiveColor:"var(--theme-switch-bg)",activeColor:"var(--theme-color-primary)",size:"16",activeValue:1,modelValue:i.isEnablePower,"onUpdate:modelValue":l[5]||(l[5]=e=>i.isEnablePower=e)},null,8,["modelValue"])])),_:1})])),_:1}),u(p,{class:"text-[var(--theme-text-blue)] text-[12px] leading-5"},{default:c((()=>[_(v(q(F)("set_auth.tips0")),1)])),_:1})])),_:1})])),_:1})])),_:1}),u(j,{class:"!my-0"}),u(te,{data:i.menuList,modelValue:i.roleForm.rules,"onUpdate:modelValue":l[6]||(l[6]=e=>i.roleForm.rules=e),props:{label:"menu_name",value:"menu_key",key:"id"},disabled:!i.isEnablePower},null,8,["data","modelValue","disabled"])])),_:1}),u(p,{class:"main-fix-footer bg-[#fff] z-100 grid grid-cols-2 gap-2",style:{"box-shadow":"var(--theme-box-shadow)"}},{default:c((()=>[u(Y,{text:m.value,onClick:l[7]||(l[7]=e=>ne.value=!0),plain:!0,customStyle:"color: var(--theme-color-main);",iconColor:"var(--theme--color-main)",color:"var(--theme-border)"},null,8,["text"]),u(Y,{text:q(F)("save"),onClick:me,color:"var(--theme-color-primary)"},null,8,["text"])])),_:1})])),_:1},8,["style"]),u(D,{show:ne.value,"onUpdate:show":l[9]||(l[9]=e=>ne.value=e),width:300,showConfirmButton:!1,contentTextAlign:"center"},{confirmButton:c((()=>[u(p,{class:"flex gap-3"},{default:c((()=>[u(Y,{onClick:l[8]||(l[8]=e=>ne.value=!1),class:"!text-[#303133]",color:"#f4f5f7",text:q(F)("cancel")},null,8,["text"]),u(Y,{text:q(F)("OK"),onClick:fe,color:"#e0b87a"},null,8,["text"])])),_:1})])),default:c((()=>[u(p,{class:"!box-border w-full text-[var(--theme-color-main)] text-center"},{default:c((()=>[_(v(q(F)("update_and_save")),1)])),_:1})])),_:1},8,["show"]),u(Z,{show:ce.value,mode:"bottom",onClose:l[13]||(l[13]=e=>ce.value=!1),onOpen:l[14]||(l[14]=()=>{}),class:"custom-popup"},{default:c((()=>[u(p,{class:"p-3 flex justify-between items-center"},{default:c((()=>[u(p),u(p,{class:"flex !text-center font-bold text-[30rpx]"},{default:c((()=>[_(v(q(F)("select.role")),1)])),_:1}),u(z,{name:"close",size:"15",onClick:l[10]||(l[10]=e=>ce.value=!1)})])),_:1}),u(G),u(p,{class:"p-3 mb-5"},{default:c((()=>[u(p,{class:"mb-2 flex justify-between items-center"},{default:c((()=>[u(p,{class:"text-xs text-[var(--theme-color-tips)]"},{default:c((()=>[_(v(q(F)("left_slide_delete_role")),1)])),_:1}),u(p,{class:"flex justify-end items-center",onClick:l[11]||(l[11]=e=>de.value=!0)},{default:c((()=>[u(z,{name:"plus-circle-fill",color:"var(--theme-color-primary)",size:"15"}),u(p,{class:"h-[17px] text-xs text-[var(--theme-color-primary)] ml-1"},{default:c((()=>[_(v(q(F)("add_role")),1)])),_:1})])),_:1})])),_:1}),(n(!0),r(b,null,y(i.roleList,((e,a)=>(n(),d(X,{key:a,class:"mt-[10px] mb-[10px]"},{default:c((()=>[u(W,{options:re,onClick:l=>((e,l)=>{le({role_id:e.role_id}).then((e=>{V({title:F("delete_success"),icon:"none"}),i.roleList.splice(l,1)})).catch((()=>{V({title:F("delete_error"),icon:"none"})}))})(e,a)},{default:c((()=>[u(J,{modelValue:i.roleForm.role_id,"onUpdate:modelValue":l[12]||(l[12]=e=>i.roleForm.role_id=e),placement:"column",iconPlacement:"right",onChange:l=>(async({role_id:e})=>{i.form.role_ids=[e],ce.value=!1,i.loading=!0,await w(),i.loading=!1})(e),size:"15",activeColor:"var(--theme-color-primary)",shape:"circle"},{default:c((()=>[u(H,{labelColor:"#333",labelSize:"14",label:e.role_name,name:e.role_id},null,8,["label","name"])])),_:2},1032,["modelValue","onChange"])])),_:2},1032,["options","onClick"])])),_:2},1024)))),128))])),_:1})])),_:1},8,["show"]),u(D,{show:de.value,"onUpdate:show":l[17]||(l[17]=e=>de.value=e),width:300,showConfirmButton:!1,contentTextAlign:"center"},{confirmButton:c((()=>[u(p,{class:"flex gap-3"},{default:c((()=>[u(Y,{onClick:l[16]||(l[16]=e=>de.value=!1),class:"!text-[#303133]",color:"#f4f5f7",text:q(F)("cancel")},null,8,["text"]),u(Y,{text:q(F)("OK"),onClick:oe,color:"#e0b87a"},null,8,["text"])])),_:1})])),default:c((()=>[u(p,{class:"flex flex-col items-center w-full"},{default:c((()=>[u(p,{class:"flex !text-center font-bold text-base mb-3"},{default:c((()=>[_(v(q(F)("add_role")),1)])),_:1}),u(p,{class:"flex flex-col !box-border w-full !bg-[#f4f5f7] p-2 !rounded"},{default:c((()=>[u(C,{placeholder:q(F)("input.role_name"),border:"none",modelValue:i.roleForm.role_name,"onUpdate:modelValue":l[15]||(l[15]=e=>i.roleForm.role_name=e),inputAlign:"center",clearable:""},null,8,["placeholder","modelValue"])])),_:1})])),_:1})])),_:1},8,["show"]),u(ee,{loading:i.loading},null,8,["loading"])],64)}}}),[["__scopeId","data-v-87f7b08a"]]);export{oe as default};
