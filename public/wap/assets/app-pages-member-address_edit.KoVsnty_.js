import{d as e,r as a,S as l,bh as t,a7 as r,b as s,aO as i,c as d,o as c,e as o,w as u,f as n,p,a2 as v,t as m,h as f,g as _,v as x,a0 as y,am as h,a1 as b,I as g,bi as k,i as C,al as w,B as V,T as P,bj as A,y as S,bk as q,E as I,U as j,V as z,bl as T,W as U,u as W,n as $,s as E,bg as M,bm as O,be as R,a as B,ap as N,q as D,M as F,_ as G}from"./index-VHk1sExB.js";import{m as H}from"./manifest.BsDGljPW.js";const J=e({__name:"area-select",props:{areaId:{type:Number,default:0}},emits:["complete"],setup(e,{expose:V,emit:P}){const A=e,S=a(!1),q=l({province:[],city:[],district:[]}),I=a("province"),j=l({province:null,city:null,district:null});t(0).then((({data:e})=>{q.province=e})).catch(),r((()=>A.areaId),((e,a)=>{e&&!a&&k(e).then((({data:e})=>{e.province&&(j.province=e.province),e.city&&(j.city=e.city),e.district&&(j.district=e.district)}))}),{immediate:!0}),r((()=>j.province),(()=>{t(j.province.id).then((({data:e})=>{if(q.city=e,I.value="city",j.city){let a=!1;for(let l=0;l<e.length;l++)if(j.city.id==e[l].id){a=!0;break}a||(j.city=null)}})).catch()}),{deep:!0}),r((()=>j.city),(e=>{e?t(j.city.id).then((({data:e})=>{if(q.district=e,I.value="district",j.district){let a=!1;for(let l=0;l<e.length;l++)if(j.district.id==e[l].id){a=!0;break}a||(j.district=null)}})).catch():(q.district=[],j.district=null)}),{deep:!0});const z=P;r((()=>j.district),(e=>{e&&(I.value="district",z("complete",j),S.value=!1)}),{deep:!0});return V({open:()=>{S.value=!0}}),(e,a)=>{const l=C,t=w,r=s(d("u-popup"),i);return c(),o(r,{show:S.value,onClose:a[4]||(a[4]=e=>S.value=!1),mode:"bottom",round:10},{default:u((()=>[n(l,{onTouchmove:a[3]||(a[3]=g((()=>{}),["prevent","stop"])),class:"popup-common"},{default:u((()=>[n(l,{class:"title"},{default:u((()=>[p("请选择地区")])),_:1}),n(l,{class:"flex p-[30rpx] pt-[0] text-sm font-500"},{default:u((()=>[q.province.length?(c(),o(l,{key:0,class:v(["flex-1 pr-[10rpx]",{"text-[var(--primary-color)]":"province"==I.value}]),onClick:a[0]||(a[0]=e=>I.value="province")},{default:u((()=>[j.province?(c(),o(l,{key:0},{default:u((()=>[p(m(j.province.name),1)])),_:1})):(c(),o(l,{key:1},{default:u((()=>[p("请选择")])),_:1}))])),_:1},8,["class"])):f("",!0),q.city.length?(c(),o(l,{key:1,class:v(["flex-1 pr-[10rpx]",{"text-[var(--primary-color)]":"city"==I.value}]),onClick:a[1]||(a[1]=e=>I.value="city")},{default:u((()=>[j.city?(c(),o(l,{key:0},{default:u((()=>[p(m(j.city.name),1)])),_:1})):(c(),o(l,{key:1},{default:u((()=>[p("请选择")])),_:1}))])),_:1},8,["class"])):f("",!0),q.district.length?(c(),o(l,{key:2,class:v(["flex-1 pr-[10rpx]",{"text-[var(--primary-color)]":"district"==I.value}]),onClick:a[2]||(a[2]=e=>I.value="district")},{default:u((()=>[j.district?(c(),o(l,{key:0},{default:u((()=>[p(m(j.district.name),1)])),_:1})):(c(),o(l,{key:1},{default:u((()=>[p("请选择")])),_:1}))])),_:1},8,["class"])):f("",!0)])),_:1}),n(t,{"scroll-y":"true",class:"h-[50vh]"},{default:u((()=>[n(l,{class:"flex p-[30rpx] pt-0 text-sm"},{default:u((()=>[q.province.length?_((c(),o(l,{key:0},{default:u((()=>[(c(!0),y(b,null,h(q.province,(e=>(c(),o(l,{class:v(["h-[80rpx] flex items-center",{"text-[var(--primary-color)]":j.province&&j.province.id==e.id}]),onClick:a=>j.province=e},{default:u((()=>[p(m(e.name),1)])),_:2},1032,["class","onClick"])))),256))])),_:1},512)),[[x,"province"==I.value]]):f("",!0),q.city.length?_((c(),o(l,{key:1},{default:u((()=>[(c(!0),y(b,null,h(q.city,(e=>(c(),o(l,{class:v(["h-[80rpx] flex items-center",{"text-[var(--primary-color)]":j.city&&j.city.id==e.id}]),onClick:a=>j.city=e},{default:u((()=>[p(m(e.name),1)])),_:2},1032,["class","onClick"])))),256))])),_:1},512)),[[x,"city"==I.value]]):f("",!0),q.district.length?_((c(),o(l,{key:2},{default:u((()=>[(c(!0),y(b,null,h(q.district,(e=>(c(),o(l,{class:v(["h-[80rpx] flex items-center",{"text-[var(--primary-color)]":j.district&&j.district.id==e.id}]),onClick:a=>j.district=e},{default:u((()=>[p(m(e.name),1)])),_:2},1032,["class","onClick"])))),256))])),_:1},512)),[[x,"district"==I.value]]):f("",!0)])),_:1})])),_:1})])),_:1})])),_:1},8,["show"])}}}),K=G(e({__name:"address_edit",setup(e){const l=a({id:0,name:"",mobile:"",province_id:0,city_id:0,district_id:0,lat:"",lng:"",address:"",address_name:"",full_address:"",is_default:0,area:""}),t=a(),r=a(null),i=a(""),f=a(!1),_=a(!1),x=a("address"),y=a(2);a(null),V((e=>{y.value=e.isSelectMap||"";const a=P("selectAddressCallback");if(e.id)A(e.id).then((e=>{e.data&&Object.assign(l.value,e.data),a&&(x.value="express"==a.delivery?"address":"locationAddress")}));else if(e.name){P("addressInfo")&&Object.assign(l.value,P("addressInfo")),l.value.address=e.name,L(e.latng);var t=Q("latng").split(",");l.value.lat=t[0],l.value.lng=t[1]}i.value=e.source||"",a&&(x.value="express"==a.delivery?"address":"locationAddress")}));const h=S((()=>({name:{type:"string",required:!0,message:E("namePlaceholder"),trigger:["blur","change"]},mobile:[{type:"string",required:!0,message:E("mobilePlaceholder"),trigger:["blur","change"]},{validator(e,a,l){/^1[3-9]\d{9}$/.test(a)?l():l(new Error(E("mobileError")))}}],area:{validator(){let e=!0;return uni.$u.test.isEmpty(l.value.area)&&uni.$u.test.isEmpty(l.value.address_name)&&(e=!1),e},message:E("selectAreaPlaceholder")},address:{type:"string",required:!0,message:E("addressPlaceholder"),trigger:["blur","change"]}}))),b=()=>{_.value=!0,t.value.open()},k=e=>{!_.value||l.value.province_id!=e.province.id&&l.value.city_id==e.city.id&&l.value.district_id==e.district.id||(l.value.lat="",l.value.lng=""),l.value.province_id=e.province.id||0,l.value.city_id=e.city.id||0,l.value.district_id=e.district.id||0,l.value.area=`${e.province.name||""}${e.city.name||""}${e.district.name||""}`,_.value=!1},w=a(!1),G=()=>{const e=l.value.id?M:O;r.value.validate().then((()=>{if(!w.value){if(w.value=!0,f.value=!0,l.value.full_address=l.value.area+l.value.address,1==y.value&&!l.value.lat&&!l.value.lng)return I({title:"缺少经纬度，请在地图上重新选点",icon:"none"}),w.value=!1,f.value=!1,!1;e(l.value).then((e=>{w.value=!1,setTimeout((()=>{if(f.value=!1,"shop_order_payment"==i.value){const a=P("selectAddressCallback");a&&(a.address_id=e.data.id||l.value.id,R({key:"selectAddressCallback",data:a,success(){B({url:a.back,mode:"redirectTo"})}}))}else B({url:"/app/pages/member/address",mode:"redirectTo",param:{source:i.value}})}),1e3)})).catch((()=>{w.value=!1,f.value=!1}))}}))},K=()=>{var e=l.value;N("addressInfo",e);let a=location.origin+location.pathname+"?source="+i.value;y.value&&(a=a+"&isSelectMap="+y.value),window.location.href="https://apis.map.qq.com/tools/locpicker?search=1&type=0&backurl="+encodeURIComponent(a)+"&key="+H.h5.sdkConfigs.maps.qqmap.key+"&referer=myapp"},L=e=>{q({latlng:e}).then((e=>{e.data?(l.value.full_address="",l.value.full_address+=null!=e.data.province?e.data.province:"",l.value.full_address+=null!=e.data.city?""+e.data.city:"",l.value.full_address+=null!=e.data.district?""+e.data.district:"",l.value.address_name=l.value.full_address.replace(/-/g,""),l.value.area=e.data.province+e.data.city+e.data.district||e.data.full_address,l.value.province_id=null!=e.data.province_id?e.data.province_id:0,l.value.city_id=null!=e.data.city_id?e.data.city_id:0,l.value.district_id=null!=e.data.district_id?e.data.district_id:0):I({title:e.msg,icon:"none"})}))},Q=e=>{for(var a=window.location.search.substring(1).split("&"),l=0;l<a.length;l++){var t=a[l].split("=");if(t[0]==e)return t[1]}return!1};return(e,a)=>{const i=s(d("u-input"),j),_=s(d("u-form-item"),z),V=C,P=D,A=s(d("u-switch"),T),S=s(d("u-form"),U),q=F,I=s(d("area-select"),J);return c(),o(V,{class:"bg-[var(--page-bg-color)] min-h-[100vh] overflow-hidden address-edit",style:$(e.themeColor())},{default:u((()=>[n(S,{labelPosition:"left",model:l.value,errorType:"toast",rules:h.value,ref_key:"formRef",ref:r},{default:u((()=>[n(V,{class:"sidebar-margin card-template mt-[var(--top-m)] py-[20rpx]"},{default:u((()=>[n(V,{class:""},{default:u((()=>[n(_,{label:W(E)("name"),prop:"name",labelWidth:"200rpx"},{default:u((()=>[n(i,{fontSize:"28rpx",modelValue:l.value.name,"onUpdate:modelValue":a[0]||(a[0]=e=>l.value.name=e),modelModifiers:{trim:!0},border:"none",clearable:"",maxlength:"25",placeholderStyle:"color: #888",placeholder:W(E)("namePlaceholder")},null,8,["modelValue","placeholder"])])),_:1},8,["label"])])),_:1}),n(V,{class:"mt-[16rpx]"},{default:u((()=>[n(_,{label:W(E)("mobile"),prop:"mobile",labelWidth:"200rpx"},{default:u((()=>[n(i,{fontSize:"28rpx",modelValue:l.value.mobile,"onUpdate:modelValue":a[1]||(a[1]=e=>l.value.mobile=e),modelModifiers:{trim:!0},maxlength:"11",border:"none",clearable:"",placeholder:W(E)("mobilePlaceholder"),placeholderStyle:"color: #888"},null,8,["modelValue","placeholder"])])),_:1},8,["label"])])),_:1}),n(V,{class:"mt-[16rpx]"},{default:u((()=>[n(_,{label:W(E)("selectArea"),prop:"area",labelWidth:"200rpx"},{default:u((()=>["address"==x.value&&1!=y.value?(c(),o(V,{key:0,class:"flex w-full items-center h-[52rpx]",onClick:b},{default:u((()=>[l.value.area?(c(),o(V,{key:1,class:"text-[28rpx] flex-1 leading-[1.4]"},{default:u((()=>[p(m(l.value.area),1)])),_:1})):(c(),o(V,{key:0,class:"text-[#888] text-[28rpx] flex-1"},{default:u((()=>[p(m(W(E)("selectAreaPlaceholder")),1)])),_:1})),n(V,{onClick:g(K,["stop"]),class:"flex items-center"},{default:u((()=>[n(P,{class:"nc-iconfont nc-icon-dizhiguanliV6xx mr-[4rpx] text-[32rpx] text-[#e93323]"}),n(P,{class:"text-[24rpx] whitespace-nowrap text-[#e93323]"},{default:u((()=>[p("定位")])),_:1})])),_:1})])),_:1})):(c(),o(V,{key:1,class:"flex justify-between items-center flex-1 h-[52rpx]",onClick:K},{default:u((()=>[l.value.area||l.value.address_name?(c(),o(V,{key:0,class:"text-[28rpx] text-[#303133] leading-[1.4]"},{default:u((()=>[p(m(l.value.area||l.value.address_name),1)])),_:1})):(c(),o(V,{key:1,class:"text-[#888] text-[28rpx]"},{default:u((()=>[p(m(W(E)("selectAddressPlaceholder")),1)])),_:1})),n(V,{class:"flex items-center"},{default:u((()=>[n(P,{class:"nc-iconfont nc-icon-dizhiguanliV6xx text-[32rpx] mr-[4rpx] text-[#e93323]"}),n(P,{class:"text-[24rpx] whitespace-nowrap text-[#e93323]"},{default:u((()=>[p("定位")])),_:1})])),_:1})])),_:1}))])),_:1},8,["label"])])),_:1}),n(V,{class:"mt-[16rpx]"},{default:u((()=>[n(_,{label:W(E)("address"),prop:"address",labelWidth:"200rpx"},{default:u((()=>[n(i,{fontSize:"28rpx",modelValue:l.value.address,"onUpdate:modelValue":a[2]||(a[2]=e=>l.value.address=e),border:"none",clearable:"",maxlength:"120",placeholder:W(E)("addressPlaceholder"),placeholderStyle:"color: #888"},null,8,["modelValue","placeholder"])])),_:1},8,["label"])])),_:1})])),_:1}),n(V,{class:"sidebar-margin card-template mt-[var(--top-m)] py-[10rpx]"},{default:u((()=>[n(_,{label:W(E)("defaultAddress"),prop:"name","border-bottom":!1,labelWidth:"200rpx"},{default:u((()=>[n(A,{modelValue:l.value.is_default,"onUpdate:modelValue":a[3]||(a[3]=e=>l.value.is_default=e),size:"20",activeValue:1,inactiveValue:0,activeColor:"var(--primary-color)",inactiveColor:"var(--temp-bg)"},null,8,["modelValue"])])),_:1},8,["label"])])),_:1})])),_:1},8,["model","rules"]),n(V,{class:"w-full footer"},{default:u((()=>[n(V,{class:"py-[var(--top-m)] px-[var(--sidebar-m)] footer w-full fixed bottom-0 left-0 right-0 box-border"},{default:u((()=>[n(q,{"hover-class":"none",class:v(["primary-btn-bg !text-[#fff] h-[80rpx] leading-[80rpx] rounded-[100rpx] text-[26rpx] font-500",{"opacity-50":f.value}]),onClick:G,disabled:f.value,loading:w.value},{default:u((()=>[p(m(W(E)("save")),1)])),_:1},8,["disabled","loading","class"])])),_:1})])),_:1}),n(I,{ref_key:"areaRef",ref:t,onComplete:k,"area-id":l.value.district_id},null,8,["area-id"])])),_:1},8,["style"])}}}),[["__scopeId","data-v-aa0a9d53"]]);export{K as default};
