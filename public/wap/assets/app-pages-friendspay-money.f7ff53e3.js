import{d as e,s as a,bM as t,r as l,bX as r,a as s,g as u,i as o,o as n,c as p,w as i,B as d,b as c,z as f,A as x,u as m,G as _,ag as v,Q as y,R as g,am as b,F as h,f as k,x as w,j,al as F,D as S,q as T,y as C,aL as I,aM as B,K as P,L as R,n as O,t as z,I as L,E as A,S as E,C as M}from"./index-29ba8fd9.js";import{_ as G}from"./u-avatar.f180454f.js";import{_ as H}from"./u--image.42bb5b8e.js";import{_ as U}from"./u-image.62f6b7a7.js";import{_ as $}from"./u-icon.c465a7de.js";import{_ as q}from"./u-popup.6009a61d.js";import{p as D,g as J}from"./pay.ddfcb3b0.js";import{_ as K}from"./_plugin-vue_export-helper.1b428a4d.js";import{_ as N}from"./loading-page.vue_vue_type_script_setup_true_lang.a41a83eb.js";import{t as Q}from"./topTabbar.e79d7cbd.js";import{g as V,_ as X}from"./message.vue_vue_type_script_setup_true_lang.8f9019f6.js";import"./u-transition.1dc24f47.js";import"./u-status-bar.c0d013e9.js";import"./u-loading-icon.8c8b11d4.js";const W=K(e({__name:"pay",emits:["close","confirm"],setup(e,{expose:T,emit:C}){a()&&t.init();const I=l(!1),B=l(!1),P=l(null),R=l(""),O=()=>{var e,l,r,u;if(!uni.$u.test.isEmpty(R.value))return"friendspay"==R.value?(s({url:"/app/pages/friendspay/share",param:{id:null==(e=P.value)?void 0:e.trade_id,type:null==(l=P.value)?void 0:l.trade_type},mode:"redirectTo"}),!1):void(B.value||(B.value=!0,D({trade_type:null==(r=P.value)?void 0:r.trade_type,trade_id:null==(u=P.value)?void 0:u.trade_id,type:R.value,openid:uni.getStorageSync("openid")||""}).then((e=>{var l,r,u,o,n,p;switch(R.value){case"wechatpay":a()?(e.data.timestamp=e.data.timeStamp,delete e.data.timeStamp,t.pay({...e.data,success:()=>{L()},cancel:()=>{B.value=!1}})):(uni.setStorageSync("paymenting",{trade_type:null==(l=P.value)?void 0:l.trade_type,trade_id:null==(r=P.value)?void 0:r.trade_id}),location.href=e.data.h5_url);break;case"alipay":a()?s({url:"/app/pages/pay/browser",param:{trade_type:null==(u=P.value)?void 0:u.trade_type,trade_id:null==(o=P.value)?void 0:o.trade_id,alipay:encodeURIComponent(e.data.url)},mode:"redirectTo"}):(uni.setStorageSync("paymenting",{trade_type:null==(n=P.value)?void 0:n.trade_type,trade_id:null==(p=P.value)?void 0:p.trade_id}),location.href=e.data.url);break;default:if(e.data.url)return void s({url:e.data.url,param:e.data.param||{},mode:"redirectTo"});L()}})).catch((()=>{B.value=!1}))));w({title:_("pay.notHavePayType"),icon:"none"})};r("checkIsReturnAfterPayment",(()=>{const e=uni.getStorageSync("paymenting");uni.getStorageSync("paymenting")&&s({url:"/app/pages/pay/result",param:{trade_type:e.trade_type,trade_id:e.trade_id},mode:"redirectTo",success(){uni.removeStorageSync("paymenting")}})}));const z=l(!1),L=()=>{var e,a;C("confirm"),s({url:"/app/pages/pay/result",param:{trade_type:null==(e=P.value)?void 0:e.trade_type,trade_id:null==(a=P.value)?void 0:a.trade_id},mode:"redirectTo"})},A=()=>{uni.removeStorageSync("paymenting"),I.value=!1,C("close")};return T({open:(e,a,t="",l="")=>{if(z.value)return;z.value=!0,uni.setStorageSync("payReturn",encodeURIComponent(t));const r={};l&&(r.scene=l),J(e,a,r).then((e=>{let{data:a}=e;P.value=a,uni.$u.test.isEmpty(a)?w({title:_("pay.notObtainedInfo"),icon:"none"}):0!=a.money?(R.value=a.pay_type_list[0]?a.pay_type_list[0].key:"",I.value=!0,z.value=!1):L()})).catch((()=>{z.value=!1}))}}),(e,a)=>{const t=j,l=u(o("u-image"),U),r=u(o("u-icon"),$),s=F,w=S,T=u(o("u-popup"),q);return n(),p(T,{show:I.value,round:10,onClose:A,closeable:!0,bgColor:"#fff",zIndex:"10081",closeOnClickOverlay:!1},{default:i((()=>[P.value?(n(),p(t,{key:0,class:"flex flex-col h-[65vh] popup-common",onTouchmove:a[0]||(a[0]=d((()=>{}),["prevent","stop"]))},{default:i((()=>[c(t,{class:"head"},{default:i((()=>[c(t,{class:"title"},{default:i((()=>[f(x(m(_)("pay.payTitle")),1)])),_:1}),c(t,{class:"flex items-end justify-center w-full text-xl font-bold py-[20rpx] price-font"},{default:i((()=>[c(t,{class:"text-base mr-[4rpx]"},{default:i((()=>[f(x(m(_)("currency")),1)])),_:1}),f(" "+x(m(v)(P.value.money)),1)])),_:1})])),_:1}),c(s,{"scroll-y":"true",class:"flex-1 pt-[20rpx]"},{default:i((()=>[c(t,{class:"flex text-[28rpx] px-[36rpx] py-[20rpx] mb-[10rpx]"},{default:i((()=>[c(t,{class:"text-[var(--text-color-light6)]"},{default:i((()=>[f(x(m(_)("pay.orderInfo")),1)])),_:1}),c(t,{class:"text-right flex-1 pl-[30rpx] truncate"},{default:i((()=>[f(x(P.value.body),1)])),_:1})])),_:1}),c(t,{class:"mx-[var(--popup-sidebar-m)] px-[30rpx] bg-white rounded-[20rpx] bg-[var(--temp-bg)]"},{default:i((()=>[P.value.pay_type_list.length?(n(!0),y(g,{key:0},b(P.value.pay_type_list,((e,a)=>(n(),p(t,{class:"pay-item py-[30rpx] flex items-center border-0 border-b border-solid border-[#eee]",key:a,onClick:a=>R.value=e.key},{default:i((()=>[c(l,{src:m(h)(e.icon),width:"50rpx",height:"50rpx"},null,8,["src"]),c(t,{class:"flex-1 px-[20rpx] text-[28rpx] font-500"},{default:i((()=>[f(x(e.name),1)])),_:2},1024),e.key==R.value?(n(),p(r,{key:0,name:"checkbox-mark",color:"var(--primary-color)"})):k("v-if",!0)])),_:2},1032,["onClick"])))),128)):(n(),p(t,{key:1,class:"py-[30rpx] text-center text-[24rpx] text-gray-subtitle"},{default:i((()=>[f(x(m(_)("pay.notHavePayType")),1)])),_:1}))])),_:1})])),_:1}),c(t,{class:"btn-wrap"},{default:i((()=>[c(w,{class:"primary-btn-bg btn","hover-class":"none",loading:B.value,onClick:O},{default:i((()=>[f(x(m(_)("pay.confirmPay")),1)])),_:1},8,["loading"])])),_:1})])),_:1})):k("v-if",!0)])),_:1},8,["show"])}}}),[["__scopeId","data-v-5094ad20"]]),Y=K(e({__name:"money",setup(e){const a=Q();a.setTopTabbarParam({title:""});const t=l(!0),r=l(0),d=l(""),v=l({}),w=l(!1),F=l(!0),U=l(null);T((e=>{r.value=e.id||0,d.value=e.type||""})),C((()=>{r.value&&d.value&&$(d.value,r.value)})),I((()=>{U.value&&(clearTimeout(U.value),U.value=null)})),B((()=>{U.value&&(clearTimeout(U.value),U.value=null)}));const $=(e,l)=>{F.value&&(t.value=!0,F.value=!1),V(e,l).then((r=>{v.value=r.data,P({title:v.value.config.pay_page_name}),a.setTopTabbarParam({title:v.value.config.pay_page_name}),t.value=!1,2!=v.value.status&&1!=v.value.status&&-1!=v.value.status?U.value=setTimeout((()=>{$(e,l)}),3e3):(clearTimeout(U.value),U.value=null)})).catch((()=>{U.value&&(clearTimeout(U.value),U.value=null),t.value=!1;R({title:"未找到帮付订单信息",url:"/app/pages/index/index",mode:"reLaunch"})}))},q=l(null),D=()=>{q.value.open(v.value.config)},J=l(),K=()=>{var e;z()?null==(e=J.value)||e.open(v.value.trade_type,v.value.trade_id,"/app/pages/index/index","friendspay"):L().setLoginBack({url:"/app/pages/friendspay/money",param:{id:v.value.trade_id,type:v.value.trade_type}})};return(e,a)=>{const l=u(o("u-avatar"),G),r=A,d=j,F=S,T=M,C=u(o("u--image"),H),I=u(o("pay"),W),B=u(o("loading-page"),N);return n(),p(d,{style:O(e.themeColor())},{default:i((()=>[Object.keys(v.value).length&&!t.value?(n(),p(d,{key:0,class:"bg-[var(--page-bg-color)] min-h-screen overflow-hidden"},{default:i((()=>[c(d,{style:O({background:"url("+m(h)("static/resource/images/app/friendpay_money.png")+") left bottom / cover no-repeat"}),class:"pb-[194rpx] overflow-hidden"},{default:i((()=>[c(d,{class:"mt-[20rpx] flex flex-col items-center"},{default:i((()=>[c(l,{src:m(h)(v.value.member.headimg),size:"50",leftIcon:"none","default-url":m(h)("static/resource/images/default_headimg.png")},null,8,["src","default-url"]),c(d,{class:"flex items-center mt-[20rpx] text-[#fff] text-[26rpx] leading-[36rpx]"},{default:i((()=>[c(r,{class:"font-bold mr-[10rpx] max-w-[250rpx] truncate"},{default:i((()=>[f(x(v.value.member.nickname),1)])),_:1}),c(r,null,{default:i((()=>[f("请您帮忙付款~")])),_:1})])),_:1}),v.value.config.pay_leave_message?(n(),p(d,{key:0,class:"message bg-[#fe0708] relative max-w-[520rpx] px-[20rpx] py-[12rpx] rounded-[12rpx] border-solid border-[1rpx] border-color text-[24rpx] text-[#fff] leading-[30rpx] box-border text-center mt-[20rpx] mx-[114rpx]"},{default:i((()=>[f(x(v.value.config.pay_leave_message),1)])),_:1})):k("v-if",!0)])),_:1})])),_:1},8,["style"]),c(d,{class:"-mt-[154rpx] card-template sidebar-margin mb-[var(--top-m)]"},{default:i((()=>[c(d,{class:"text-[24rpx] text-center mb-[10rpx]"},{default:i((()=>[f(x(m(_)("payMoney")),1)])),_:1}),c(d,{class:"text-center mb-[50rpx]"},{default:i((()=>[c(r,{class:"text-[32rpx] font-500 price-font text-[#FF4142]"},{default:i((()=>[f("￥")])),_:1}),c(r,{class:"text-[56rpx] font-bold price-font text-[#FF4142]"},{default:i((()=>[f(x(parseFloat(v.value.money).toFixed(2).split(".")[0]),1)])),_:1}),c(r,{class:"text-[32rpx] font-500 price-font text-[#FF4142]"},{default:i((()=>[f("."+x(parseFloat(v.value.money).toFixed(2).split(".")[1]),1)])),_:1})])),_:1}),c(d,{class:"px-[20rpx] box-border"},{default:i((()=>[2==v.value.status?(n(),p(F,{key:0,class:"bg-[#FFB4B1] !text-[#fff] h-[80rpx] leading-[80rpx] rounded-[100rpx] text-[26rpx] font-500","hover-class":"none"},{default:i((()=>[f(x(m(_)("finish")),1)])),_:1})):-1==v.value.status?(n(),p(F,{key:1,class:"bg-[#FFB4B1] !text-[#fff] h-[80rpx] leading-[80rpx] rounded-[100rpx] text-[26rpx] font-500","hover-class":"none"},{default:i((()=>[f(x(m(_)("close")),1)])),_:1})):(n(),p(F,{key:2,class:"primary-btn-bg !text-[#fff] h-[80rpx] leading-[80rpx] rounded-[100rpx] text-[26rpx] font-500","hover-class":"none",loading:w.value,onClick:K},{default:i((()=>[f(x(v.value.config.pay_button_name?v.value.config.pay_button_name:m(_)("payGenerously")),1)])),_:1},8,["loading"]))])),_:1}),c(d,{class:"mt-[20rpx] flex items-baseline justify-center text-[var(--text-color-light9)]",onClick:a[0]||(a[0]=e=>m(s)({url:"/app/pages/index/index"}))},{default:i((()=>[c(r,{class:"text-[24rpx] mr-[6rpx]"},{default:i((()=>[f("返回首页")])),_:1})])),_:1})])),_:1}),c(d,{class:"card-template sidebar-margin mb-[var(--top-m)]"},{default:i((()=>[v.value.config.pay_info_switch?(n(),y(g,{key:0},["[]"!==JSON.stringify(v.value.trade_info)&&v.value.trade_info.item_list.length?(n(),y(g,{key:0},[c(d,{class:"flex justify-between items-center mb-[30rpx]"},{default:i((()=>[c(d,{class:"text-[30rpx] text-[#333] font-500"},{default:i((()=>[f(x(m(_)("helpPayInfo")),1)])),_:1}),v.value.config.pay_explain_switch?(n(),p(d,{key:0,class:"flex-shrink-0",onClick:D},{default:i((()=>[c(r,{class:"mr-[8rpx] text-[24rpx]"},{default:i((()=>[f(x(v.value.config.pay_explain_title),1)])),_:1}),c(r,{class:"nc-iconfont nc-icon-jichuxinxiV6xx text-[26rpx]"})])),_:1})):k("v-if",!0)])),_:1}),c(d,{class:"border-0 border-solid border-b-[1rpx] border-[#f6f6f6] mb-[20rpx]"},{default:i((()=>[(n(!0),y(g,null,b(v.value.trade_info.item_list,((e,a)=>(n(),p(d,{class:E(["flex justify-between",{" mb-[34rpx]":a+1!=v.value.trade_info.length}])},{default:i((()=>[c(d,{class:"w-[170rpx] h-[170rpx] rounded-[var(--goods-rounded-big)] overflow-hidden flex-shrink-0"},{default:i((()=>[c(C,{class:"overflow-hidden",radius:"var(--goods-rounded-big)",width:"170rpx",height:"170rpx",src:m(h)(e.item_image?e.item_image:""),model:"aspectFill"},{error:i((()=>[c(T,{class:"w-[170rpx] h-[170rpx] rounded-[var(--goods-rounded-big)] overflow-hidden",src:m(h)("static/resource/images/diy/shop_default.jpg"),mode:"aspectFill"},null,8,["src"])])),_:2},1032,["src"])])),_:2},1024),c(d,{class:"ml-[20rpx] flex flex-1 flex-col justify-between"},{default:i((()=>[c(d,null,{default:i((()=>[c(d,{class:"text-[28rpx] using-hidden leading-[40rpx] text-[#333]"},{default:i((()=>[f(x(e.item_name),1)])),_:2},1024),e.item_sub_name?(n(),p(d,{key:0,class:"text-[24rpx] mt-[14rpx] text-[var(--text-color-light9)] using-hidden leading-[28rpx]"},{default:i((()=>[f(x(e.item_sub_name),1)])),_:2},1024)):k("v-if",!0)])),_:2},1024),c(d,{class:"flex justify-between items-baseline"},{default:i((()=>[c(d,{class:"price-font text-[#FF4142]"},{default:i((()=>[c(r,{class:"text-[24rpx]"},{default:i((()=>[f("￥")])),_:1}),c(r,{class:"text-[40rpx] font-500"},{default:i((()=>[f(x(parseFloat(e.item_price).toFixed(2).split(".")[0]),1)])),_:2},1024),c(r,{class:"text-[24rpx] font-500"},{default:i((()=>[f("."+x(parseFloat(e.item_price).toFixed(2).split(".")[1]),1)])),_:2},1024)])),_:2},1024),c(r,{class:"text-right text-[26rpx]"},{default:i((()=>[f("x"+x(e.item_num),1)])),_:2},1024)])),_:2},1024)])),_:2},1024)])),_:2},1032,["class"])))),256))])),_:1}),c(d,{class:"text-[26rpx] text-right"},{default:i((()=>[f(x(v.value.trade_info.item_total),1)])),_:1})],64)):(n(),p(d,{key:1,class:"text-[28rpx] leading-[40rpx] text-[#333]"},{default:i((()=>[f(x(v.value.body),1)])),_:1}))],64)):k("v-if",!0)])),_:1})])),_:1})):k("v-if",!0),k(" 帮付说明 "),c(X,{ref_key:"messageRef",ref:q},null,512),k(" 支付 "),c(I,{ref_key:"payRef",ref:J},null,512),c(B,{loading:t.value},null,8,["loading"])])),_:1},8,["style"])}}}),[["__scopeId","data-v-da6da26e"]]);export{Y as default};
